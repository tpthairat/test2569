<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏Ñ‡∏£‡∏ö‡∏ä‡∏∏‡∏î</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Sarabun', sans-serif; 
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-warning {
            animation: pulseWarning 1s infinite;
        }
        
        @keyframes pulseWarning {
            0%, 100% { background-color: rgb(239 68 68); }
            50% { background-color: rgb(220 38 38); }
        }
        
        /* Card Animations */
        .answer-card {
            transition: all 0.3s ease;
        }
        
        .answer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .answer-card.selected {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        /* Loading Spinner */
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Progress Bar Animation */
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        /* Mobile Optimizations */
        .touch-target {
            min-height: 48px;
            min-width: 48px;
        }
        
        @media (max-width: 640px) {
            .mobile-padding {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }
        
        /* Table Responsive */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Sticky Header */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 40;
            backdrop-filter: blur(10px);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-full"><!-- Firebase SDK v9 -->
  <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, doc, getDoc, setDoc, getDocs, query, orderBy, where, serverTimestamp, deleteDoc, updateDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // Firebase Configuration - ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Global Firebase functions
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.collection = collection;
        window.addDoc = addDoc;
        window.doc = doc;
        window.getDoc = getDoc;
        window.setDoc = setDoc;
        window.getDocs = getDocs;
        window.query = query;
        window.orderBy = orderBy;
        window.where = where;
        window.serverTimestamp = serverTimestamp;
        window.deleteDoc = deleteDoc;
        window.updateDoc = updateDoc;
        window.onSnapshot = onSnapshot;
        
        // Initialize app when Firebase is ready
        window.initializeApp = function() {
            checkAuthState();
        };
        
        // Auto-initialize
        window.initializeApp();
    </script><!-- Login Screen -->
  <div id="loginScreen" class="min-h-full flex items-center justify-center mobile-padding py-8">
   <div class="w-full max-w-md fade-in"><!-- Header -->
    <div class="text-center mb-8">
     <div class="text-6xl mb-4">
      üéì
     </div>
     <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-3">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
     <p class="text-lg text-gray-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</p>
    </div><!-- Login Form -->
    <div class="bg-white rounded-2xl p-6 shadow-lg mb-6">
     <form id="loginForm" class="space-y-6">
      <div><label for="email" class="block text-sm font-semibold text-gray-700 mb-2"> üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏• </label> <input type="email" id="email" required class="w-full px-4 py-4 text-lg border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
      </div>
      <div><label for="password" class="block text-sm font-semibold text-gray-700 mb-2"> üîí ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô </label> <input type="password" id="password" required class="w-full px-4 py-4 text-lg border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
      </div><button type="submit" id="loginBtn" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all transform hover:scale-105 shadow-lg touch-target"> üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
     </form>
    </div><!-- Register Toggle -->
    <div class="text-center">
     <p class="text-gray-600 mb-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ?</p><button onclick="toggleRegisterMode()" id="toggleBtn" class="text-blue-600 hover:text-blue-800 font-semibold underline"> ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å </button>
    </div>
   </div>
  </div><!-- Pre-Exam Screen -->
  <div id="preExamScreen" class="hidden min-h-full flex items-center justify-center mobile-padding py-8">
   <div class="w-full max-w-md fade-in"><!-- User Info -->
    <div class="bg-white rounded-2xl p-6 shadow-lg mb-6">
     <div class="text-center mb-6">
      <div class="text-4xl mb-3">
       üëã
      </div>
      <h2 class="text-2xl font-bold text-gray-800 mb-2">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
      <p id="welcomeUser" class="text-lg text-gray-600"></p>
     </div><!-- Name Input -->
     <div class="mb-6"><label for="examinerName" class="block text-sm font-semibold text-gray-700 mb-2"> üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• </label> <input type="text" id="examinerName" required class="w-full px-4 py-4 text-lg border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
     </div>
     <div class="space-y-4">
      <div class="flex justify-between items-center p-4 bg-blue-50 rounded-xl"><span class="font-semibold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</span> <span class="text-blue-600 font-bold">15 ‡∏Ç‡πâ‡∏≠</span>
      </div>
      <div class="flex justify-between items-center p-4 bg-green-50 rounded-xl"><span class="font-semibold text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</span> <span class="text-green-600 font-bold">30 ‡∏ô‡∏≤‡∏ó‡∏µ</span>
      </div>
      <div class="flex justify-between items-center p-4 bg-purple-50 rounded-xl"><span class="font-semibold text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°</span> <span class="text-purple-600 font-bold">100 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
      </div>
     </div>
    </div><!-- Start Exam Button --> <button onclick="startExam()" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-6 px-8 rounded-2xl text-xl transition-all transform hover:scale-105 shadow-lg touch-target mb-4"> üìù ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö </button> <!-- Logout Button --> <button onclick="logout()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl transition-colors touch-target"> üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
   </div>
  </div><!-- Already Taken Screen -->
  <div id="alreadyTakenScreen" class="hidden min-h-full flex items-center justify-center mobile-padding py-8">
   <div class="w-full max-w-md fade-in text-center">
    <div class="bg-white rounded-2xl p-8 shadow-lg">
     <div class="text-6xl mb-6">
      ‚úÖ
     </div>
     <h2 class="text-2xl font-bold text-gray-800 mb-4">‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</h2>
     <p class="text-gray-600 mb-6">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
     <div id="userScore" class="bg-blue-50 rounded-xl p-4 mb-6"><!-- ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
     </div><button onclick="logout()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-colors touch-target"> üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
    </div>
   </div>
  </div><!-- Exam Screen -->
  <div id="examScreen" class="hidden min-h-full"><!-- Timer Header -->
   <div class="sticky-header bg-white/90 border-b border-gray-200 px-4 py-3">
    <div class="flex justify-between items-center max-w-4xl mx-auto">
     <div>
      <div class="text-sm text-gray-600">
       ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö
      </div>
      <div id="examinerNameDisplay" class="font-semibold text-gray-800 truncate max-w-32"></div>
     </div>
     <div class="text-right">
      <div class="text-sm text-gray-600">
       ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
      </div>
      <div id="timer" class="text-xl font-bold text-red-600 bg-red-50 px-3 py-1 rounded-lg">
       30:00
      </div>
     </div>
    </div><!-- Progress Bar -->
    <div class="mt-3 max-w-4xl mx-auto">
     <div class="flex justify-between items-center mb-2"><span class="text-sm font-semibold text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span> <span id="progressText" class="text-sm font-semibold text-blue-600">0/15</span>
     </div>
     <div class="w-full bg-gray-200 rounded-full h-2">
      <div id="progressBar" class="progress-bar bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full" style="width: 0%"></div>
     </div>
    </div>
   </div>
   <div class="mobile-padding py-6 max-w-4xl mx-auto"><!-- Question Container -->
    <div id="questionContainer" class="bg-white rounded-2xl p-6 mb-6 shadow-lg"><!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
    </div><!-- Navigation -->
    <div class="flex flex-col sm:flex-row gap-4 justify-between"><button id="prevBtn" onclick="previousQuestion()" class="order-2 sm:order-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-6 rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed touch-target"> ‚Üê ‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ </button>
     <div class="order-1 sm:order-2 flex gap-4"><button id="nextBtn" onclick="nextQuestion()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-colors touch-target"> ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí </button> <button id="submitBtn" onclick="confirmSubmit()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition-colors hidden touch-target"> ‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö </button>
     </div>
    </div>
   </div>
  </div><!-- Result Screen -->
  <div id="resultScreen" class="hidden min-h-full flex items-center justify-center mobile-padding py-8">
   <div class="w-full max-w-2xl fade-in"><!-- Header -->
    <div class="text-center mb-8">
     <div class="text-6xl mb-4">
      üéâ
     </div>
     <h2 class="text-3xl font-bold text-gray-800 mb-4">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö</h2>
    </div><!-- Score Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">
     <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg">
      <div class="text-center">
       <div class="text-sm opacity-90 mb-2">
        ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ
       </div>
       <div id="finalScore" class="text-4xl font-bold">
        0/100
       </div>
      </div>
     </div>
     <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-2xl p-6 text-white shadow-lg">
      <div class="text-center">
       <div class="text-sm opacity-90 mb-2">
        ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
       </div>
       <div id="timeUsed" class="text-4xl font-bold">
        00:00
       </div>
      </div>
     </div>
    </div><!-- Result Details -->
    <div id="resultDetails" class="bg-white rounded-2xl p-6 mb-8 shadow-lg"><!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö -->
    </div><!-- Logout Button --> <button onclick="logout()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-6 px-8 rounded-2xl text-xl transition-all transform hover:scale-105 shadow-lg touch-target"> üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
   </div>
  </div><!-- Admin Dashboard -->
  <div id="dashboardScreen" class="hidden min-h-full"><!-- Dashboard Header -->
   <div class="bg-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-6">
     <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
      <div>
       <h1 class="text-3xl font-bold text-gray-800">üìä Dashboard ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h1>
       <p class="text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
      </div>
      <div class="flex gap-3"><button onclick="showQuestionManager()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl transition-colors touch-target"> üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö </button> <button onclick="exportToCSV()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl transition-colors touch-target"> üì• Export CSV </button> <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl transition-colors touch-target"> üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
      </div>
     </div>
    </div>
   </div>
   <div class="max-w-7xl mx-auto px-4 py-6"><!-- Stats Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
     <div class="bg-white rounded-2xl p-6 shadow-lg">
      <div class="flex items-center justify-between">
       <div>
        <div class="text-sm text-gray-500 mb-1">
         ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </div>
        <div id="totalExams" class="text-2xl font-bold text-blue-600">
         0
        </div>
       </div>
       <div class="text-3xl">
        üë•
       </div>
      </div>
     </div>
     <div class="bg-white rounded-2xl p-6 shadow-lg">
      <div class="flex items-center justify-between">
       <div>
        <div class="text-sm text-gray-500 mb-1">
         ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
        </div>
        <div id="avgScore" class="text-2xl font-bold text-green-600">
         0
        </div>
       </div>
       <div class="text-3xl">
        üìà
       </div>
      </div>
     </div>
     <div class="bg-white rounded-2xl p-6 shadow-lg">
      <div class="flex items-center justify-between">
       <div>
        <div class="text-sm text-gray-500 mb-1">
         ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
        </div>
        <div id="maxScore" class="text-2xl font-bold text-purple-600">
         0
        </div>
       </div>
       <div class="text-3xl">
        üèÜ
       </div>
      </div>
     </div>
     <div class="bg-white rounded-2xl p-6 shadow-lg">
      <div class="flex items-center justify-between">
       <div>
        <div class="text-sm text-gray-500 mb-1">
         ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå
        </div>
        <div id="passRate" class="text-2xl font-bold text-orange-600">
         0%
        </div>
       </div>
       <div class="text-3xl">
        ‚úÖ
       </div>
      </div>
     </div>
    </div><!-- Filters -->
    <div class="bg-white rounded-2xl p-6 shadow-lg mb-6">
     <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠</label> <input type="text" id="searchName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" onkeyup="filterResults()">
      </div>
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">üìä ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</label> <select id="scoreFilter" onchange="filterResults()" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors"> <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option> <option value="pass">‡∏ú‡πà‡∏≤‡∏ô (‚â•60)</option> <option value="fail">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (&lt;60)</option> <option value="excellent">‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (‚â•80)</option> </select>
      </div>
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">üìÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°</label> <select id="sortBy" onchange="sortResults()" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors"> <option value="date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö (‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î)</option> <option value="score-desc">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏™‡∏π‡∏á-‡∏ï‡πà‡∏≥)</option> <option value="score-asc">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ï‡πà‡∏≥-‡∏™‡∏π‡∏á)</option> <option value="name">‡∏ä‡∏∑‡πà‡∏≠ (A-Z)</option> </select>
      </div>
     </div>
    </div><!-- Results Table -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
     <div class="table-container">
      <table class="w-full">
       <thead class="bg-gray-50">
        <tr>
         <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
         <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
         <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
         <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</th>
         <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö</th>
         <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        </tr>
       </thead>
       <tbody id="resultsTableBody"><!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
       </tbody>
      </table>
     </div>
     <div id="noResults" class="hidden text-center py-12">
      <div class="text-4xl mb-4">
       üì≠
      </div>
      <p class="text-gray-500 text-lg">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö</p>
     </div>
    </div>
   </div>
  </div><!-- Question Manager Screen -->
  <div id="questionManagerScreen" class="hidden min-h-full"><!-- Header -->
   <div class="bg-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-6">
     <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
      <div>
       <h1 class="text-3xl font-bold text-gray-800">üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h1>
       <p class="text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</p>
      </div>
      <div class="flex gap-3"><button onclick="showAddQuestionForm()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors touch-target"> ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà </button> <button onclick="showScreen('dashboardScreen')" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-xl transition-colors touch-target"> ‚Üê ‡∏Å‡∏•‡∏±‡∏ö Dashboard </button>
      </div>
     </div>
    </div>
   </div>
   <div class="max-w-7xl mx-auto px-4 py-6"><!-- Add Question Form -->
    <div id="addQuestionForm" class="hidden bg-white rounded-2xl p-6 shadow-lg mb-6">
     <h2 class="text-2xl font-bold text-gray-800 mb-6">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</h2>
     <form id="questionForm" class="space-y-6">
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</label> <textarea id="questionText" required rows="3" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors resize-none" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°..."></textarea>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">üÖ∞Ô∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A</label> <input type="text" id="option1" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A">
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">üÖ±Ô∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B</label> <input type="text" id="option2" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B">
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">üÖ≤ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C</label> <input type="text" id="option3" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C">
       </div>
       <div><label class="block text-sm font-semibold text-gray-700 mb-2">üÖ≥ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D</label> <input type="text" id="option4" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D">
       </div>
      </div>
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">‚úÖ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</label> <select id="correctAnswer" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors"> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</option> <option value="0">A</option> <option value="1">B</option> <option value="2">C</option> <option value="3">D</option> </select>
      </div>
      <div class="flex gap-4"><button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition-colors touch-target"> üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö </button> <button type="button" onclick="hideAddQuestionForm()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-6 rounded-xl transition-colors touch-target"> ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button>
      </div>
     </form>
    </div><!-- Questions List -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
     <div class="px-6 py-4 bg-gray-50 border-b">
      <div class="flex justify-between items-center">
       <h3 class="text-xl font-semibold text-gray-800">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h3>
       <div id="questionCount" class="text-sm text-gray-600">
        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 0 ‡∏Ç‡πâ‡∏≠
       </div>
      </div>
     </div>
     <div id="questionsList" class="divide-y divide-gray-200"><!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
     </div>
     <div id="noQuestions" class="text-center py-12">
      <div class="text-4xl mb-4">
       üìù
      </div>
      <p class="text-gray-500 text-lg">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</p><button onclick="showAddQuestionForm()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors touch-target"> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÅ‡∏£‡∏Å </button>
     </div>
    </div>
   </div>
  </div><!-- Edit Question Modal -->
  <div id="editQuestionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 mobile-padding">
   <div class="bg-white rounded-2xl p-6 w-full max-w-2xl shadow-2xl max-h-full overflow-y-auto">
    <h3 class="text-2xl font-bold text-gray-800 mb-6">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h3>
    <form id="editQuestionForm" class="space-y-6"><input type="hidden" id="editQuestionId">
     <div><label class="block text-sm font-semibold text-gray-700 mb-2">‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</label> <textarea id="editQuestionText" required rows="3" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors resize-none" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°..."></textarea>
     </div>
     <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">üÖ∞Ô∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A</label> <input type="text" id="editOption1" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A">
      </div>
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">üÖ±Ô∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B</label> <input type="text" id="editOption2" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B">
      </div>
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">üÖ≤ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C</label> <input type="text" id="editOption3" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C">
      </div>
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">üÖ≥ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D</label> <input type="text" id="editOption4" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D">
      </div>
     </div>
     <div><label class="block text-sm font-semibold text-gray-700 mb-2">‚úÖ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</label> <select id="editCorrectAnswer" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors"> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</option> <option value="0">A</option> <option value="1">B</option> <option value="2">C</option> <option value="3">D</option> </select>
     </div>
     <div class="flex gap-4"><button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-colors touch-target"> üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç </button> <button type="button" onclick="hideEditQuestionModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-6 rounded-xl transition-colors touch-target"> ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button>
     </div>
    </form>
   </div>
  </div><!-- Delete Confirmation Modal -->
  <div id="deleteConfirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 mobile-padding">
   <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl">
    <div class="text-center mb-6">
     <div class="text-4xl mb-4">
      üóëÔ∏è
     </div>
     <h3 class="text-xl font-bold text-gray-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
     <p class="text-gray-600">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ?</p>
    </div>
    <div class="flex gap-4"><button onclick="hideDeleteConfirmModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl transition-colors touch-target"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button onclick="confirmDeleteQuestion()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-xl transition-colors touch-target"> ‡∏•‡∏ö </button>
    </div>
   </div>
  </div><!-- Confirmation Modal -->
  <div id="confirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 mobile-padding">
   <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl">
    <div class="text-center mb-6">
     <div class="text-4xl mb-4">
      ‚ö†Ô∏è
     </div>
     <h3 class="text-xl font-bold text-gray-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</h3>
     <p class="text-gray-600">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö?</p>
    </div>
    <div class="flex gap-4"><button onclick="hideConfirmModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl transition-colors touch-target"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button onclick="submitExam()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl transition-colors touch-target"> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö </button>
    </div>
   </div>
  </div><!-- Toast Notification -->
  <div id="toast" class="hidden fixed top-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-xl shadow-lg z-50 mx-auto max-w-sm">
   <div class="flex items-center">
    <div class="loading-spinner mr-3"></div><span id="toastMessage">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</span>
   </div>
  </div>
  <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Firebase)
        let examQuestions = [];

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        let currentUser = null;
        let isRegisterMode = false;
        let currentQuestion = 0;
        let userAnswers = [];
        let examStartTime = null;
        let examEndTime = null;
        let timerInterval = null;
        let timeRemaining = 30 * 60; // 30 ‡∏ô‡∏≤‡∏ó‡∏µ
        let shuffledQuestions = [];
        let isExamActive = false;
        let allExamResults = [];
        let questionToDelete = null;
        let examinerName = '';

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
        function checkAuthState() {
            window.onAuthStateChanged(window.firebaseAuth, async (user) => {
                if (user) {
                    currentUser = user;
                    await handleUserLogin(user);
                } else {
                    currentUser = null;
                    showScreen('loginScreen');
                }
            });
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        async function handleUserLogin(user) {
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
            
            try {
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Firebase
                await loadQuestionsFromFirebase();
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô admin ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const userDoc = await window.getDoc(window.doc(window.firebaseDb, 'users', user.uid));
                const userData = userDoc.data();
                
                if (userData && userData.role === 'admin') {
                    // ‡πÅ‡∏™‡∏î‡∏á Dashboard ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö admin
                    await loadDashboardData();
                    showScreen('dashboardScreen');
                    return;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                const examDoc = await window.getDoc(window.doc(window.firebaseDb, 'examResults', user.uid));
                
                if (examDoc.exists()) {
                    // ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß - ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö
                    const examData = examDoc.data();
                    showUserScore(examData);
                    showScreen('alreadyTakenScreen');
                } else {
                    // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö - ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏≠‡∏ö
                    document.getElementById('welcomeUser').textContent = user.email;
                    showScreen('preExamScreen');
                }
            } catch (error) {
                console.error('Error checking user data:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Firebase
        async function loadQuestionsFromFirebase() {
            try {
                const q = window.query(window.collection(window.firebaseDb, 'questions'), window.orderBy('createdAt', 'asc'));
                const querySnapshot = await window.getDocs(q);
                
                examQuestions = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    examQuestions.push({
                        id: doc.id,
                        question: data.question,
                        options: data.options,
                        correct: data.correct
                    });
                });
                
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏ô Firebase ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                if (examQuestions.length === 0) {
                    await createDefaultQuestions();
                }
                
            } catch (error) {
                console.error('Error loading questions:', error);
                // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
                examQuestions = getDefaultQuestions();
            }
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        async function createDefaultQuestions() {
            const defaultQuestions = getDefaultQuestions();
            
            try {
                for (const question of defaultQuestions) {
                    await window.addDoc(window.collection(window.firebaseDb, 'questions'), {
                        question: question.question,
                        options: question.options,
                        correct: question.correct,
                        createdAt: window.serverTimestamp()
                    });
                }
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
                await loadQuestionsFromFirebase();
                
            } catch (error) {
                console.error('Error creating default questions:', error);
                examQuestions = defaultQuestions;
            }
        }

        // ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        function getDefaultQuestions() {
            return [
                {
                    question: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÉ‡∏î?",
                    options: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà"],
                    correct: 0
                },
                {
                    question: "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÉ‡∏î?",
                    options: ["‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏≠‡πÄ‡∏°‡∏ã‡∏≠‡∏ô", "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÑ‡∏ô‡∏•‡πå", "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÅ‡∏¢‡∏á‡∏ã‡∏µ‡πÄ‡∏Å‡∏µ‡∏¢‡∏á", "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏°‡∏¥‡∏™‡∏ã‡∏¥‡∏™‡∏ã‡∏¥‡∏õ‡∏õ‡∏µ"],
                    correct: 1
                },
                {
                    question: "‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡∏î‡∏≤‡∏ß‡πÉ‡∏î?",
                    options: ["‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡∏î‡∏≤‡∏ß‡∏û‡∏∏‡∏ò", "‡∏î‡∏≤‡∏ß‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏î‡∏≤‡∏ß‡πÇ‡∏•‡∏Å"],
                    correct: 1
                },
                {
                    question: "‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÉ‡∏î‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å?",
                    options: ["‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢", "‡∏à‡∏µ‡∏ô", "‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤", "‡∏≠‡∏¥‡∏ô‡πÇ‡∏î‡∏ô‡∏µ‡πÄ‡∏ã‡∏µ‡∏¢"],
                    correct: 0
                },
                {
                    question: "‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏•‡∏π‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å?",
                    options: ["‡∏ä‡πâ‡∏≤‡∏á", "‡∏ß‡∏≤‡∏¨‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô", "‡∏¢‡∏µ‡∏£‡∏≤‡∏ü", "‡∏Æ‡∏¥‡∏õ‡πÇ‡∏õ‡πÇ‡∏õ‡πÄ‡∏ï‡∏°‡∏±‡∏™"],
                    correct: 1
                },
                {
                    question: "‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡πÉ‡∏î?",
                    options: ["‡πÄ‡∏≠‡πÄ‡∏ß‡∏≠‡πÄ‡∏£‡∏™‡∏ï‡πå", "K2", "‡∏Å‡∏¥‡∏•‡∏¥‡∏°‡∏±‡∏ô‡∏à‡∏≤‡πÇ‡∏£", "‡∏ü‡∏π‡∏à‡∏¥"],
                    correct: 0
                },
                {
                    question: "‡∏°‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏°‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£‡πÉ‡∏î?",
                    options: ["‡πÅ‡∏≠‡∏ï‡πÅ‡∏•‡∏ô‡∏ï‡∏¥‡∏Å", "‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢", "‡πÅ‡∏õ‡∏ã‡∏¥‡∏ü‡∏¥‡∏Å", "‡∏≠‡∏≤‡∏£‡πå‡∏Å‡∏ï‡∏¥‡∏Å"],
                    correct: 2
                },
                {
                    question: "‡∏ò‡∏≤‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå Au ‡∏Ñ‡∏∑‡∏≠‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î?",
                    options: ["‡πÄ‡∏á‡∏¥‡∏ô", "‡∏ó‡∏≠‡∏á", "‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á", "‡πÄ‡∏´‡∏•‡πá‡∏Å"],
                    correct: 1
                },
                {
                    question: "‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÉ‡∏î‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å?",
                    options: ["‡πÅ‡∏Ñ‡∏ô‡∏≤‡∏î‡∏≤", "‡∏à‡∏µ‡∏ô", "‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤", "‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢"],
                    correct: 3
                },
                {
                    question: "‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ '‡∏î‡∏≤‡∏ß‡πÅ‡∏î‡∏á'?",
                    options: ["‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡∏î‡∏≤‡∏ß‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏î‡∏≤‡∏ß‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏î‡∏≤‡∏ß‡πÄ‡∏™‡∏≤‡∏£‡πå"],
                    correct: 1
                },
                {
                    question: "‡∏™‡∏µ‡πÉ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô?",
                    options: ["‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", "‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á", "‡∏°‡πà‡∏ß‡∏á", "‡∏™‡πâ‡∏°"],
                    correct: 2
                },
                {
                    question: "‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏≠‡∏Ñ‡∏≠‡∏¢‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏•?",
                    options: ["‡∏≠‡∏¥‡∏ï‡∏≤‡∏•‡∏µ", "‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™", "‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏ô‡∏µ", "‡∏™‡πÄ‡∏õ‡∏ô"],
                    correct: 1
                },
                {
                    question: "‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ô‡∏Å?",
                    options: ["‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏≤‡∏ß", "‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠", "‡πÅ‡∏°‡∏•‡∏á‡∏ß‡∏±‡∏ô", "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô"],
                    correct: 3
                },
                {
                    question: "‡∏ó‡∏ß‡∏µ‡∏õ‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?",
                    options: ["‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢", "‡πÅ‡∏≠‡∏ü‡∏£‡∏¥‡∏Å‡∏≤", "‡∏¢‡∏∏‡πÇ‡∏£‡∏õ", "‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤‡πÉ‡∏ï‡πâ"],
                    correct: 1
                },
                {
                    question: "‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏à‡∏∞‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏Å‡∏µ‡πà‡∏≠‡∏á‡∏®‡∏≤‡πÄ‡∏ã‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏™?",
                    options: ["0 ‡∏≠‡∏á‡∏®‡∏≤", "32 ‡∏≠‡∏á‡∏®‡∏≤", "100 ‡∏≠‡∏á‡∏®‡∏≤", "-10 ‡∏≠‡∏á‡∏®‡∏≤"],
                    correct: 0
                }
            ];
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        function showUserScore(examData) {
            const scoreHtml = `
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600 mb-2">${examData.score}/100</div>
                    <div class="text-sm text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: ${examData.timeUsed}</div>
                </div>
            `;
            document.getElementById('userScore').innerHTML = scoreHtml;
        }

        // Toggle ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Login ‡πÅ‡∏•‡∏∞ Register
        function toggleRegisterMode() {
            isRegisterMode = !isRegisterMode;
            const form = document.getElementById('loginForm');
            const toggleBtn = document.getElementById('toggleBtn');
            const loginBtn = document.getElementById('loginBtn');
            
            if (isRegisterMode) {
                loginBtn.innerHTML = 'üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
                toggleBtn.textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            } else {
                loginBtn.innerHTML = 'üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
                toggleBtn.textContent = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
            }
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Login Form
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...', 'info');
            
            try {
                if (isRegisterMode) {
                    // ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                    const userCredential = await window.createUserWithEmailAndPassword(window.firebaseAuth, email, password);
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                    await window.setDoc(window.doc(window.firebaseDb, 'users', userCredential.user.uid), {
                        email: email,
                        createdAt: window.serverTimestamp(),
                        role: 'student' // default role
                    });
                    
                    showToast('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } else {
                    // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    await window.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                    showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                }
            } catch (error) {
                console.error('Auth error:', error);
                let errorMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                        break;
                    case 'auth/email-already-in-use':
                        errorMessage = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                        break;
                    case 'auth/weak-password':
                        errorMessage = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                        break;
                }
                
                showToast(errorMessage, 'error');
            }
        });

        // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        async function logout() {
            try {
                await window.signOut(window.firebaseAuth);
                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                resetExamState();
                showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                console.error('Logout error:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö', 'error');
            }
        }

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö
        function resetExamState() {
            currentQuestion = 0;
            userAnswers = [];
            examStartTime = null;
            examEndTime = null;
            timeRemaining = 30 * 60;
            shuffledQuestions = [];
            isExamActive = false;
            examinerName = '';
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            localStorage.removeItem('currentExam');
            window.onpopstate = null;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö
        function startExam() {
            if (!currentUser) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠
            examinerName = document.getElementById('examinerName').value.trim();
            if (!examinerName) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', 'error');
                document.getElementById('examinerName').focus();
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const savedExam = localStorage.getItem('currentExam');
            if (savedExam) {
                const examData = JSON.parse(savedExam);
                const confirmResume = window.confirm('‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');
                if (confirmResume) {
                    resumeExam(examData);
                    return;
                } else {
                    localStorage.removeItem('currentExam');
                }
            }

            // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
            shuffledQuestions = shuffleArray([...examQuestions]);
            
            // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠
            shuffledQuestions = shuffledQuestions.map(q => {
                const correctAnswer = q.options[q.correct];
                const shuffledOptions = shuffleArray([...q.options]);
                const newCorrectIndex = shuffledOptions.indexOf(correctAnswer);
                
                return {
                    ...q,
                    options: shuffledOptions,
                    correct: newCorrectIndex
                };
            });

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
            examStartTime = new Date();
            isExamActive = true;
            startTimer();
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö
            saveExamState();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö
            document.getElementById('examinerNameDisplay').textContent = examinerName;
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            showScreen('examScreen');
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡πÅ‡∏£‡∏Å
            showQuestion();
            
            // ‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
            preventBackNavigation();
        }

        // ‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
        function preventBackNavigation() {
            history.pushState(null, null, location.href);
            window.onpopstate = function () {
                if (isExamActive) {
                    history.go(1);
                    showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'warning');
                }
            };
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö
        function saveExamState() {
            const examState = {
                currentQuestion,
                userAnswers,
                examStartTime: examStartTime.toISOString(),
                timeRemaining,
                shuffledQuestions,
                examinerName
            };
            localStorage.setItem('currentExam', JSON.stringify(examState));
        }

        // ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö
        function resumeExam(examData) {
            currentQuestion = examData.currentQuestion;
            userAnswers = examData.userAnswers;
            examStartTime = new Date(examData.examStartTime);
            timeRemaining = examData.timeRemaining;
            shuffledQuestions = examData.shuffledQuestions;
            examinerName = examData.examinerName || '‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö';
            isExamActive = true;

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≠
            startTimer();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö
            document.getElementById('examinerNameDisplay').textContent = examinerName;
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            showScreen('examScreen');
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            showQuestion();
            
            // ‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
            preventBackNavigation();
        }

        // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                saveExamState(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                
                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ 1 ‡∏ô‡∏≤‡∏ó‡∏µ
                if (timeRemaining === 60) {
                    showToast('‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏µ‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ!', 'warning');
                }
                
                // ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    showToast('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...', 'info');
                    setTimeout(() => submitExam(), 2000);
                }
            }, 1000);
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timerElement = document.getElementById('timer');
            
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡πâ‡∏≠‡∏¢ (5 ‡∏ô‡∏≤‡∏ó‡∏µ)
            if (timeRemaining <= 300) {
                timerElement.classList.add('pulse-warning');
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
        function showQuestion() {
            const question = shuffledQuestions[currentQuestion];
            const container = document.getElementById('questionContainer');
            
            container.innerHTML = `
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <span class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-semibold">
                            ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${currentQuestion + 1}
                        </span>
                        <span class="text-gray-500 text-sm">${currentQuestion + 1}/${shuffledQuestions.length}</span>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 leading-relaxed mb-6">${question.question}</h3>
                </div>
                
                <div class="space-y-4">
                    ${question.options.map((option, index) => `
                        <div class="answer-card cursor-pointer p-4 border-2 border-gray-200 rounded-xl transition-all touch-target ${userAnswers[currentQuestion] === index ? 'selected' : ''}" 
                             onclick="selectAnswer(${index})">
                            <div class="flex items-center">
                                <div class="w-6 h-6 rounded-full border-2 border-current mr-4 flex items-center justify-center flex-shrink-0">
                                    <div class="w-3 h-3 rounded-full bg-current ${userAnswers[currentQuestion] === index ? 'opacity-100' : 'opacity-0'}"></div>
                                </div>
                                <span class="text-lg font-medium">${String.fromCharCode(65 + index)}. ${option}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            updateProgress();
            updateNavigationButtons();
        }

        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
        function selectAnswer(answerIndex) {
            userAnswers[currentQuestion] = answerIndex;
            saveExamState(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
            showQuestion(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            updateProgress();
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤
        function updateProgress() {
            const answered = userAnswers.filter(answer => answer !== undefined).length;
            const progress = (answered / shuffledQuestions.length) * 100;
            
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${answered}/${shuffledQuestions.length}`;
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.disabled = currentQuestion === 0;
            
            if (currentQuestion === shuffledQuestions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        // ‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
                saveExamState();
            }
        }

        // ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        function nextQuestion() {
            if (currentQuestion < shuffledQuestions.length - 1) {
                currentQuestion++;
                showQuestion();
                saveExamState();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        function confirmSubmit() {
            document.getElementById('confirmModal').classList.remove('hidden');
        }

        // ‡∏ã‡πà‡∏≠‡∏ô Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        function hideConfirmModal() {
            document.getElementById('confirmModal').classList.add('hidden');
        }

        // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
        async function submitExam() {
            hideConfirmModal();
            clearInterval(timerInterval);
            isExamActive = false;
            examEndTime = new Date();
            
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö...', 'info');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            const score = calculateScore();
            const timeUsed = Math.floor((examEndTime - examStartTime) / 1000);
            
            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            const examData = {
                uid: currentUser.uid,
                email: currentUser.email,
                name: examinerName,
                score: score,
                totalQuestions: shuffledQuestions.length,
                answers: userAnswers,
                correctAnswers: shuffledQuestions.map(q => q.correct),
                timeUsed: formatTime(timeUsed),
                startTime: examStartTime,
                endTime: examEndTime,
                device: navigator.userAgent,
                submittedAt: window.serverTimestamp()
            };
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase
            try {
                await window.setDoc(window.doc(window.firebaseDb, 'examResults', currentUser.uid), examData);
                showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
                // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
                localStorage.removeItem('currentExam');
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                setTimeout(() => {
                    showResults(score, timeUsed);
                }, 2000);
                
            } catch (error) {
                console.error('Error saving exam result:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
            }
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
        function calculateScore() {
            let correct = 0;
            for (let i = 0; i < shuffledQuestions.length; i++) {
                if (userAnswers[i] === shuffledQuestions[i].correct) {
                    correct++;
                }
            }
            return Math.round((correct / shuffledQuestions.length) * 100);
        }

        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö MM:SS
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        function showResults(score, timeUsed) {
            document.getElementById('finalScore').textContent = `${score}/100`;
            document.getElementById('timeUsed').textContent = formatTime(timeUsed);
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
            let detailsHTML = '<h3 class="text-xl font-semibold mb-6 text-gray-800">üìä ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</h3>';
            
            for (let i = 0; i < shuffledQuestions.length; i++) {
                const question = shuffledQuestions[i];
                const userAnswer = userAnswers[i];
                const isCorrect = userAnswer === question.correct;
                
                detailsHTML += `
                    <div class="mb-4 p-4 rounded-xl ${isCorrect ? 'bg-green-50 border-l-4 border-green-500' : 'bg-red-50 border-l-4 border-red-500'}">
                        <div class="font-semibold mb-3 text-gray-800">‡∏Ç‡πâ‡∏≠ ${i + 1}: ${question.question}</div>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-start">
                                <span class="font-medium text-gray-600 mr-2">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</span> 
                                <span class="${isCorrect ? 'text-green-600' : 'text-red-600'} font-medium">
                                    ${userAnswer !== undefined ? question.options[userAnswer] : '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏≠‡∏ö'}
                                </span>
                            </div>
                            ${!isCorrect ? `
                                <div class="flex items-start">
                                    <span class="font-medium text-gray-600 mr-2">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å:</span> 
                                    <span class="text-green-600 font-medium">${question.options[question.correct]}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('resultDetails').innerHTML = detailsHTML;
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            showScreen('resultScreen');
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Dashboard
        async function loadDashboardData() {
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
            
            try {
                const q = window.query(window.collection(window.firebaseDb, 'examResults'), window.orderBy('submittedAt', 'desc'));
                const querySnapshot = await window.getDocs(q);
                
                allExamResults = [];
                querySnapshot.forEach((doc) => {
                    allExamResults.push({ id: doc.id, ...doc.data() });
                });
                
                updateDashboardStats();
                displayResults(allExamResults);
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Dashboard
        function updateDashboardStats() {
            const totalExams = allExamResults.length;
            const scores = allExamResults.map(result => result.score);
            const avgScore = totalExams > 0 ? Math.round(scores.reduce((a, b) => a + b, 0) / totalExams) : 0;
            const maxScore = totalExams > 0 ? Math.max(...scores) : 0;
            const passCount = scores.filter(score => score >= 60).length;
            const passRate = totalExams > 0 ? Math.round((passCount / totalExams) * 100) : 0;
            
            document.getElementById('totalExams').textContent = totalExams;
            document.getElementById('avgScore').textContent = avgScore;
            document.getElementById('maxScore').textContent = maxScore;
            document.getElementById('passRate').textContent = `${passRate}%`;
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        function displayResults(results) {
            const tbody = document.getElementById('resultsTableBody');
            const noResults = document.getElementById('noResults');
            
            if (results.length === 0) {
                tbody.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            
            tbody.innerHTML = results.map((result, index) => {
                const date = result.submittedAt ? new Date(result.submittedAt.seconds * 1000) : new Date();
                const status = result.score >= 60 ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô';
                const statusClass = result.score >= 60 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                
                return `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-6 py-4 text-sm text-gray-900">${index + 1}</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-medium">${result.name || result.email}</td>
                        <td class="px-6 py-4 text-center">
                            <span class="text-lg font-bold ${result.score >= 80 ? 'text-green-600' : result.score >= 60 ? 'text-blue-600' : 'text-red-600'}">
                                ${result.score}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-center text-sm text-gray-600">${result.timeUsed}</td>
                        <td class="px-6 py-4 text-center text-sm text-gray-600">${date.toLocaleDateString('th-TH')}</td>
                        <td class="px-6 py-4 text-center">
                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusClass}">
                                ${status}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ‡∏Å‡∏£‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        function filterResults() {
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const scoreFilter = document.getElementById('scoreFilter').value;
            
            let filteredResults = allExamResults.filter(result => {
                const name = (result.name || result.email).toLowerCase();
                const nameMatch = name.includes(searchName);
                
                let scoreMatch = true;
                if (scoreFilter === 'pass') {
                    scoreMatch = result.score >= 60;
                } else if (scoreFilter === 'fail') {
                    scoreMatch = result.score < 60;
                } else if (scoreFilter === 'excellent') {
                    scoreMatch = result.score >= 80;
                }
                
                return nameMatch && scoreMatch;
            });
            
            displayResults(filteredResults);
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        function sortResults() {
            const sortBy = document.getElementById('sortBy').value;
            
            let sortedResults = [...allExamResults];
            
            switch (sortBy) {
                case 'score-desc':
                    sortedResults.sort((a, b) => b.score - a.score);
                    break;
                case 'score-asc':
                    sortedResults.sort((a, b) => a.score - b.score);
                    break;
                case 'name':
                    sortedResults.sort((a, b) => (a.name || a.email).localeCompare(b.name || b.email));
                    break;
                case 'date':
                default:
                    sortedResults.sort((a, b) => {
                        const dateA = a.submittedAt ? a.submittedAt.seconds : 0;
                        const dateB = b.submittedAt ? b.submittedAt.seconds : 0;
                        return dateB - dateA;
                    });
                    break;
            }
            
            allExamResults = sortedResults;
            filterResults(); // Apply current filters to sorted results
        }

        // Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô CSV
        function exportToCSV() {
            if (allExamResults.length === 0) {
                showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Export', 'warning');
                return;
            }
            
            const headers = ['‡∏•‡∏≥‡∏î‡∏±‡∏ö', '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•', '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', '‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'];
            const csvContent = [
                headers.join(','),
                ...allExamResults.map((result, index) => {
                    const date = result.submittedAt ? new Date(result.submittedAt.seconds * 1000) : new Date();
                    const status = result.score >= 60 ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô';
                    
                    return [
                        index + 1,
                        `"${result.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}"`,
                        `"${result.email}"`,
                        result.score,
                        `"${result.timeUsed}"`,
                        `"${date.toLocaleDateString('th-TH')}"`,
                        `"${status}"`
                    ].join(',');
                })
            ].join('\n');
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `exam_results_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
        function showScreen(screenId) {
            const screens = ['loginScreen', 'preExamScreen', 'alreadyTakenScreen', 'examScreen', 'resultScreen', 'dashboardScreen', 'questionManagerScreen'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        // ‡πÅ‡∏™‡∏î‡∏á Toast Notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏≤‡∏° type
            toast.className = `fixed top-4 left-4 right-4 p-4 rounded-xl shadow-lg z-50 mx-auto max-w-sm ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 
                type === 'warning' ? 'bg-yellow-600' : 
                'bg-blue-600'
            } text-white`;
            
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ refresh ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à
        window.addEventListener('beforeunload', function(e) {
            if (isExamActive) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            }
        });

        // === Question Management Functions ===

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
        async function showQuestionManager() {
            await loadQuestionsFromFirebase();
            displayQuestionsList();
            showScreen('questionManagerScreen');
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
        function showAddQuestionForm() {
            document.getElementById('addQuestionForm').classList.remove('hidden');
            document.getElementById('questionText').focus();
        }

        // ‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
        function hideAddQuestionForm() {
            document.getElementById('addQuestionForm').classList.add('hidden');
            document.getElementById('questionForm').reset();
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
        document.getElementById('questionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const questionText = document.getElementById('questionText').value.trim();
            const option1 = document.getElementById('option1').value.trim();
            const option2 = document.getElementById('option2').value.trim();
            const option3 = document.getElementById('option3').value.trim();
            const option4 = document.getElementById('option4').value.trim();
            const correctAnswer = parseInt(document.getElementById('correctAnswer').value);
            
            if (!questionText || !option1 || !option2 || !option3 || !option4 || correctAnswer === '') {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö...', 'info');
            
            try {
                await window.addDoc(window.collection(window.firebaseDb, 'questions'), {
                    question: questionText,
                    options: [option1, option2, option3, option4],
                    correct: correctAnswer,
                    createdAt: window.serverTimestamp()
                });
                
                showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                hideAddQuestionForm();
                await loadQuestionsFromFirebase();
                displayQuestionsList();
                
            } catch (error) {
                console.error('Error adding question:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'error');
            }
        });

        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
        function displayQuestionsList() {
            const questionsList = document.getElementById('questionsList');
            const noQuestions = document.getElementById('noQuestions');
            const questionCount = document.getElementById('questionCount');
            
            questionCount.textContent = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${examQuestions.length} ‡∏Ç‡πâ‡∏≠`;
            
            if (examQuestions.length === 0) {
                questionsList.innerHTML = '';
                noQuestions.classList.remove('hidden');
                return;
            }
            
            noQuestions.classList.add('hidden');
            
            questionsList.innerHTML = examQuestions.map((question, index) => `
                <div class="p-6 hover:bg-gray-50 transition-colors">
                    <div class="flex justify-between items-start gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-3">
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">
                                    ‡∏Ç‡πâ‡∏≠ ${index + 1}
                                </span>
                            </div>
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">${question.question}</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                ${question.options.map((option, optIndex) => `
                                    <div class="flex items-center p-3 rounded-lg ${optIndex === question.correct ? 'bg-green-50 border-2 border-green-200' : 'bg-gray-50'}">
                                        <span class="font-medium text-sm mr-3 ${optIndex === question.correct ? 'text-green-600' : 'text-gray-600'}">
                                            ${String.fromCharCode(65 + optIndex)}.
                                        </span>
                                        <span class="${optIndex === question.correct ? 'text-green-800 font-medium' : 'text-gray-700'}">${option}</span>
                                        ${optIndex === question.correct ? '<span class="ml-2 text-green-600">‚úì</span>' : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editQuestion('${question.id}')" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg transition-colors touch-target">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="deleteQuestion('${question.id}')" 
                                    class="bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors touch-target">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
        function editQuestion(questionId) {
            const question = examQuestions.find(q => q.id === questionId);
            if (!question) return;
            
            document.getElementById('editQuestionId').value = questionId;
            document.getElementById('editQuestionText').value = question.question;
            document.getElementById('editOption1').value = question.options[0];
            document.getElementById('editOption2').value = question.options[1];
            document.getElementById('editOption3').value = question.options[2];
            document.getElementById('editOption4').value = question.options[3];
            document.getElementById('editCorrectAnswer').value = question.correct;
            
            document.getElementById('editQuestionModal').classList.remove('hidden');
        }

        // ‡∏ã‡πà‡∏≠‡∏ô Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function hideEditQuestionModal() {
            document.getElementById('editQuestionModal').classList.add('hidden');
            document.getElementById('editQuestionForm').reset();
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
        document.getElementById('editQuestionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const questionId = document.getElementById('editQuestionId').value;
            const questionText = document.getElementById('editQuestionText').value.trim();
            const option1 = document.getElementById('editOption1').value.trim();
            const option2 = document.getElementById('editOption2').value.trim();
            const option3 = document.getElementById('editOption3').value.trim();
            const option4 = document.getElementById('editOption4').value.trim();
            const correctAnswer = parseInt(document.getElementById('editCorrectAnswer').value);
            
            if (!questionText || !option1 || !option2 || !option3 || !option4 || correctAnswer === '') {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç...', 'info');
            
            try {
                await window.setDoc(window.doc(window.firebaseDb, 'questions', questionId), {
                    question: questionText,
                    options: [option1, option2, option3, option4],
                    correct: correctAnswer,
                    updatedAt: window.serverTimestamp()
                }, { merge: true });
                
                showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                hideEditQuestionModal();
                await loadQuestionsFromFirebase();
                displayQuestionsList();
                
            } catch (error) {
                console.error('Error updating question:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'error');
            }
        });

        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
        function deleteQuestion(questionId) {
            questionToDelete = questionId;
            document.getElementById('deleteConfirmModal').classList.remove('hidden');
        }

        // ‡∏ã‡πà‡∏≠‡∏ô Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
        function hideDeleteConfirmModal() {
            document.getElementById('deleteConfirmModal').classList.add('hidden');
            questionToDelete = null;
        }

        // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
        async function confirmDeleteQuestion() {
            if (!questionToDelete) return;
            
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö...', 'info');
            
            try {
                await window.deleteDoc(window.doc(window.firebaseDb, 'questions', questionToDelete));
                
                showToast('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                hideDeleteConfirmModal();
                await loadQuestionsFromFirebase();
                displayQuestionsList();
                
            } catch (error) {
                console.error('Error deleting question:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'error');
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        document.addEventListener('DOMContentLoaded', function() {
            // ‡πÉ‡∏´‡πâ focus ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
            document.getElementById('email').focus();
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99f3a963832045cf',t:'MTc2MzI2MTIyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
