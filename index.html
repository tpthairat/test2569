<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
        // Firebase imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, getDoc, setDoc, query, orderBy, where } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB8j96zKNrU_ZqkXm6uvamdF-vpjqzK-aA",
            authDomain: "test2569-319f6.firebaseapp.com",
            databaseURL: "https://test2569-319f6-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "test2569-319f6",
            storageBucket: "test2569-319f6.firebasestorage.app",
            messagingSenderId: "3578824826",
            appId: "1:3578824826:web:38e5956c347c869f0153c3"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.auth = auth;
        window.db = db;
        window.firebaseAuth = { signInWithEmailAndPassword, signOut, onAuthStateChanged };
        window.firestore = { collection, addDoc, getDocs, doc, getDoc, setDoc, query, orderBy, where };
    </script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            top: 4px;
            right: 4px;
            z-index: 1000;
            max-width: 300px;
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            background-color: #10b981;
        }
        
        .toast.error {
            background-color: #ef4444;
        }
        
        .toast.info {
            background-color: #3b82f6;
        }
        
        .question-card {
            transition: all 0.3s ease;
        }
        
        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .choice-option {
            transition: all 0.2s ease;
        }
        
        .choice-option:hover {
            background-color: #f3f4f6;
        }
        
        .choice-option.selected {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }
        
        .timer-warning {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full"><!-- Toast Notification -->
  <div id="toast" class="toast"></div><!-- Loading Screen -->
  <div id="loadingScreen" class="fixed inset-0 bg-white flex items-center justify-center z-50">
   <div class="text-center">
    <div class="loading-spinner mx-auto mb-4"></div>
    <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
   </div>
  </div><!-- Login Screen -->
  <div id="loginScreen" class="min-h-full flex items-center justify-center p-4 hidden">
   <div class="max-w-md w-full bg-white rounded-2xl shadow-xl p-8">
    <div class="text-center mb-8">
     <h1 id="appTitle" class="text-3xl font-bold text-gray-900 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
     <p class="text-gray-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö</p>
    </div>
    <form id="loginForm" class="space-y-6">
     <div><label for="email" class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div>
     <div><label for="password" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div><button type="submit" id="loginBtn" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium"> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
    </form>
    <div class="mt-6 pt-6 border-t border-gray-200">
     <p class="text-center text-sm text-gray-600 mb-4">‡∏´‡∏£‡∏∑‡∏≠</p>
     <div class="space-y-3"><button onclick="showRegisterForm()" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition duration-200 font-medium flex items-center justify-center">
       <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
       </svg> ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å </button> <button onclick="loginAsAdmin()" class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition duration-200 font-medium flex items-center justify-center">
       <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 2.676-.732 5.094-2.85 6.618-5.622z"></path>
       </svg> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô </button>
     </div>
    </div>
   </div>
  </div><!-- Register Screen -->
  <div id="registerScreen" class="min-h-full flex items-center justify-center p-4 hidden">
   <div class="max-w-md w-full bg-white rounded-2xl shadow-xl p-8">
    <div class="text-center mb-8">
     <h1 class="text-3xl font-bold text-gray-900 mb-2">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>
     <p class="text-gray-600">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
    </div>
    <form id="registerForm" class="space-y-6">
     <div><label for="regName" class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text" id="regName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div>
     <div><label for="regEmail" class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="regEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div>
     <div><label for="regPassword" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="regPassword" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div>
     <div><label for="regConfirmPassword" class="block text-sm font-medium text-gray-700 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="regConfirmPassword" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div>
     <div><label for="regPhone" class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label> <input type="tel" id="regPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div>
     <div><label for="regOrganization" class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</label> <input type="text" id="regOrganization" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div><button type="submit" id="registerBtn" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition duration-200 font-medium"> ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å </button>
    </form>
    <div class="mt-6 text-center"><button onclick="showScreen('login')" class="text-blue-600 hover:text-blue-800 text-sm"> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
    </div>
   </div>
  </div><!-- Pending Approval Screen -->
  <div id="pendingScreen" class="min-h-full flex items-center justify-center p-4 hidden">
   <div class="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center">
    <div class="text-6xl mb-4">
     ‚è≥
    </div>
    <h1 class="text-2xl font-bold text-gray-900 mb-4">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h1>
    <p class="text-gray-600 mb-6">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô<br>
     ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
     <div class="flex items-center"><span class="text-yellow-600 mr-2">üìß</span>
      <div class="text-left">
       <p class="text-sm font-medium text-yellow-800">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</p>
       <p class="text-sm text-yellow-700" id="pendingEmail">-</p>
      </div>
     </div>
    </div>
    <div class="flex gap-3 justify-center"><button onclick="checkApprovalStatus()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200"> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ </button> <button onclick="logout()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200"> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
    </div>
   </div>
  </div><!-- Student Exam Screen -->
  <div id="examScreen" class="min-h-full p-4 hidden"><!-- Header -->
   <div class="max-w-4xl mx-auto mb-6">
    <div class="bg-white rounded-2xl shadow-lg p-6">
     <div class="flex justify-between items-center flex-wrap gap-4">
      <div>
       <h1 class="text-2xl font-bold text-gray-900" id="examTitle">‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
       <p class="text-gray-600">‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏ô‡∏±‡∏¢ <span id="totalQuestions">10</span> ‡∏Ç‡πâ‡∏≠</p>
      </div>
      <div class="text-right">
       <div id="timer" class="text-3xl font-bold text-red-600">
        30:00
       </div>
       <p class="text-sm text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
      </div>
     </div>
    </div>
   </div><!-- Question Card -->
   <div class="max-w-4xl mx-auto mb-6">
    <div id="questionCard" class="question-card bg-white rounded-2xl shadow-lg p-6">
     <div class="flex justify-between items-center mb-6"><span id="questionNumber" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium"> ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1 </span>
      <div class="flex-1 mx-4">
       <div class="bg-gray-200 rounded-full h-2">
        <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 10%"></div>
       </div>
      </div><span class="text-sm text-gray-600"> <span id="currentQ">1</span>/<span id="totalQ">10</span> </span>
     </div>
     <div class="mb-6">
      <h2 id="questionText" class="text-lg font-medium text-gray-900 leading-relaxed">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...</h2>
     </div>
     <div id="choicesContainer" class="space-y-3 mb-8"><!-- Choices will be inserted here -->
     </div>
     <div class="flex justify-between gap-4"><button id="prevBtn" onclick="previousQuestion()" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed"> ‚Üê ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ </button> <button id="nextBtn" onclick="nextQuestion()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200"> ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí </button> <button id="submitBtn" onclick="submitExam()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-200 hidden"> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö </button>
     </div>
    </div>
   </div><!-- Start Exam Button -->
   <div id="startExamContainer" class="max-w-4xl mx-auto text-center">
    <div class="bg-white rounded-2xl shadow-lg p-8">
     <h2 class="text-2xl font-bold text-gray-900 mb-4">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</h2>
     <p class="text-gray-600 mb-6">‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö <span id="examDurationDisplay">30</span> ‡∏ô‡∏≤‡∏ó‡∏µ</p><button onclick="startExam()" class="bg-green-600 text-white px-8 py-4 rounded-lg text-lg font-medium hover:bg-green-700 transition duration-200"> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö </button>
    </div>
   </div>
  </div><!-- Results Screen -->
  <div id="resultsScreen" class="min-h-full p-4 hidden">
   <div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-2xl shadow-lg p-8 text-center mb-6">
     <div id="resultIcon" class="text-6xl mb-4">
      üéâ
     </div>
     <h1 class="text-3xl font-bold mb-2" id="resultTitle">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö</h1>
     <div class="text-5xl font-bold mb-4" id="scoreDisplay">
      0%
     </div>
     <p class="text-xl mb-6" id="resultMessage">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô</p>
     <div class="bg-gray-50 rounded-lg p-6 mb-6 text-left">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><span class="text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:</span> <span class="font-medium ml-2" id="finalScore">0/10</span>
       </div>
       <div><span class="text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</span> <span class="font-medium ml-2" id="timeUsed">0 ‡∏ô‡∏≤‡∏ó‡∏µ</span>
       </div>
       <div><span class="text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ú‡πà‡∏≤‡∏ô:</span> <span class="font-medium ml-2"><span id="passingScoreDisplay">60</span>%</span>
       </div>
       <div><span class="text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span> <span class="font-medium ml-2" id="passStatus">‡∏ú‡πà‡∏≤‡∏ô</span>
       </div>
      </div>
     </div>
     <div class="flex gap-4 justify-center flex-wrap"><button onclick="showAnswerReview()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition duration-200"> ‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢ </button> <button onclick="resetExam()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200"> ‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà </button> <button onclick="logout()" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition duration-200"> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
     </div>
    </div><!-- Answer Review Section -->
    <div id="answerReviewSection" class="hidden">
     <div class="bg-white rounded-2xl shadow-lg p-6">
      <div class="flex justify-between items-center mb-6">
       <h2 class="text-2xl font-bold text-gray-900">‡πÄ‡∏â‡∏•‡∏¢‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h2><button onclick="hideAnswerReview()" class="text-gray-500 hover:text-gray-700">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg></button>
      </div>
      <div id="reviewQuestions" class="space-y-6"><!-- Review questions will be inserted here -->
      </div>
     </div><!-- Members Tab -->
     <div id="membersTabContent" class="p-6 hidden">
      <div class="flex justify-between items-center mb-6">
       <h3 class="text-lg font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
       <div class="flex gap-2"><select id="memberStatusFilter" onchange="filterMembers()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option> <option value="pending">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option> <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option> <option value="rejected">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</option> </select>
       </div>
      </div><!-- Pending Approvals Alert -->
      <div id="pendingAlert" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 hidden">
       <div class="flex items-center"><span class="text-yellow-600 mr-2">‚ö†Ô∏è</span>
        <div>
         <p class="font-medium text-yellow-800">‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
         <p class="text-sm text-yellow-700">‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span id="pendingCount">0</span> ‡∏Ñ‡∏ô‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì</p>
        </div>
       </div>
      </div>
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
         </tr>
        </thead>
        <tbody id="membersTableBody" class="bg-white divide-y divide-gray-200"><!-- Members will be inserted here -->
        </tbody>
       </table>
      </div>
     </div><!-- Import Tab -->
     <div id="importTabContent" class="p-6 hidden">
      <div class="max-w-4xl">
       <h3 class="text-lg font-medium mb-6">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h3><!-- File Upload Section -->
       <div class="bg-gray-50 rounded-lg p-6 mb-6">
        <h4 class="text-md font-medium mb-4">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h4>
        <div class="space-y-4">
         <div><label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</label> <input type="file" id="examFileInput" accept=".csv,.xlsx,.xls,.pdf" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
          <p class="text-xs text-gray-500 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: CSV, Excel (.xlsx, .xls), PDF</p>
         </div>
         <div class="flex gap-4"><button onclick="processImportFile()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200"> ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö </button> <button onclick="downloadTemplate()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200"> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö CSV </button>
         </div>
        </div>
       </div><!-- Import Preview -->
       <div id="importPreview" class="bg-white border border-gray-200 rounded-lg p-6 hidden">
        <div class="flex justify-between items-center mb-4">
         <h4 class="text-md font-medium">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</h4><span id="importCount" class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">0 ‡∏Ç‡πâ‡∏≠</span>
        </div>
        <div class="overflow-x-auto mb-4">
         <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
           <tr>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</th>
           </tr>
          </thead>
          <tbody id="importPreviewBody" class="bg-white divide-y divide-gray-200"><!-- Preview data will be inserted here -->
          </tbody>
         </table>
        </div>
        <div class="flex gap-4"><button onclick="confirmImport()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200"> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ </button> <button onclick="cancelImport()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button>
        </div>
       </div><!-- Import Instructions -->
       <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h4 class="text-md font-medium text-blue-800 mb-3">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h4>
        <div class="text-sm text-blue-700 space-y-2">
         <p><strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö CSV:</strong> ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ</p>
         <ul class="list-disc list-inside ml-4 space-y-1">
          <li>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Question)</li>
          <li>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A (Option A)</li>
          <li>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B (Option B)</li>
          <li>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C (Option C)</li>
          <li>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D (Option D)</li>
          <li>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å (Correct Answer: A, B, C, ‡∏´‡∏£‡∏∑‡∏≠ D)</li>
          <li>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Category - ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</li>
          <li>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Explanation - ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</li>
         </ul>
         <p><strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Excel:</strong> ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö CSV</p>
         <p><strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö PDF:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)</p>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Admin Dashboard -->
  <div id="adminScreen" class="min-h-full p-4 hidden">
   <div class="max-w-7xl mx-auto"><!-- Header -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
     <div class="flex justify-between items-center flex-wrap gap-4">
      <div>
       <h1 class="text-3xl font-bold text-gray-900">Admin Dashboard</h1>
       <p class="text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
      </div><button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200"> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
     </div>
    </div><!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
     <div class="bg-white rounded-xl shadow-lg p-6">
      <div class="flex items-center">
       <div class="bg-blue-100 p-3 rounded-full"><span class="text-2xl">üë•</span>
       </div>
       <div class="ml-4">
        <p class="text-gray-600">‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
        <p class="text-2xl font-bold" id="totalStudents">0</p>
       </div>
      </div>
     </div>
     <div class="bg-white rounded-xl shadow-lg p-6">
      <div class="flex items-center">
       <div class="bg-green-100 p-3 rounded-full"><span class="text-2xl">‚úÖ</span>
       </div>
       <div class="ml-4">
        <p class="text-gray-600">‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô</p>
        <p class="text-2xl font-bold text-green-600" id="passedStudents">0</p>
       </div>
      </div>
     </div>
     <div class="bg-white rounded-xl shadow-lg p-6">
      <div class="flex items-center">
       <div class="bg-red-100 p-3 rounded-full"><span class="text-2xl">‚ùå</span>
       </div>
       <div class="ml-4">
        <p class="text-gray-600">‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</p>
        <p class="text-2xl font-bold text-red-600" id="failedStudents">0</p>
       </div>
      </div>
     </div>
    </div><!-- Tabs -->
    <div class="bg-white rounded-2xl shadow-lg mb-6">
     <div class="border-b border-gray-200">
      <nav class="flex space-x-8 px-6"><button onclick="showTab('results')" id="resultsTab" class="py-4 px-1 border-b-2 border-blue-500 font-medium text-blue-600"> ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö </button> <button onclick="showTab('questions')" id="questionsTab" class="py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700"> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö </button> <button onclick="showTab('members')" id="membersTab" class="py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700"> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å </button> <button onclick="showTab('import')" id="importTab" class="py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700"> ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö </button>
      </nav>
     </div><!-- Results Tab -->
     <div id="resultsTabContent" class="p-6">
      <div class="flex justify-between items-center mb-4">
       <h3 class="text-lg font-medium">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><button onclick="exportResults()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200"> Export CSV </button>
      </div>
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
         </tr>
        </thead>
        <tbody id="resultsTableBody" class="bg-white divide-y divide-gray-200"><!-- Results will be inserted here -->
        </tbody>
       </table>
      </div>
     </div><!-- Questions Tab -->
     <div id="questionsTabContent" class="p-6 hidden">
      <div class="flex justify-between items-center mb-4">
       <h3 class="text-lg font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h3><button onclick="showAddQuestionForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200"> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö </button>
      </div><!-- Add Question Form -->
      <div id="addQuestionForm" class="bg-gray-50 rounded-lg p-6 mb-6 hidden">
       <h4 class="text-lg font-medium mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</h4>
       <form id="questionForm" class="space-y-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</label> <textarea id="questionTextInput" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3"></textarea>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A</label> <input type="text" id="optionA" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
         </div>
         <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B</label> <input type="text" id="optionB" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
         </div>
         <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C</label> <input type="text" id="optionC" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
         </div>
         <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D</label> <input type="text" id="optionD" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
         </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å</label> <select id="correctAnswer" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å</option> <option value="0">A</option> <option value="1">B</option> <option value="2">C</option> <option value="3">D</option> </select>
         </div>
         <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label> <input type="text" id="category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå, ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
         </div>
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏â‡∏•‡∏¢/‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label> <textarea id="explanation" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"></textarea>
        </div>
        <div class="flex gap-4"><button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200"> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö </button> <button type="button" onclick="hideAddQuestionForm()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button>
        </div>
       </form>
      </div><!-- Questions List -->
      <div class="space-y-4" id="questionsList"><!-- Questions will be inserted here -->
      </div>
     </div><!-- Members Tab -->
     <div id="membersTabContent" class="p-6 hidden">
      <div class="flex justify-between items-center mb-6">
       <h3 class="text-lg font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
       <div class="flex gap-2"><select id="memberStatusFilter" onchange="filterMembers()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option> <option value="pending">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option> <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option> <option value="rejected">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</option> </select>
       </div>
      </div><!-- Pending Approvals Alert -->
      <div id="pendingAlert" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 hidden">
       <div class="flex items-center"><span class="text-yellow-600 mr-2">‚ö†Ô∏è</span>
        <div>
         <p class="font-medium text-yellow-800">‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
         <p class="text-sm text-yellow-700">‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span id="pendingCount">0</span> ‡∏Ñ‡∏ô‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì</p>
        </div>
       </div>
      </div>
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
         </tr>
        </thead>
        <tbody id="membersTableBody" class="bg-white divide-y divide-gray-200"><!-- Members will be inserted here -->
        </tbody>
       </table>
      </div>
     </div><!-- Import Tab -->
     <div id="importTabContent" class="p-6 hidden">
      <div class="max-w-4xl">
       <h3 class="text-lg font-medium mb-6">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h3><!-- File Upload Section -->
       <div class="bg-gray-50 rounded-lg p-6 mb-6">
        <h4 class="text-md font-medium mb-4">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h4>
        <div class="space-y-4">
         <div><label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</label> <input type="file" id="examFileInput" accept=".csv,.xlsx,.xls,.pdf" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
          <p class="text-xs text-gray-500 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: CSV, Excel (.xlsx, .xls), PDF</p>
         </div>
         <div class="flex gap-4"><button onclick="processImportFile()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200"> ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö </button> <button onclick="downloadTemplate()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200"> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö CSV </button>
         </div>
        </div>
       </div><!-- Import Preview -->
       <div id="importPreview" class="bg-white border border-gray-200 rounded-lg p-6 hidden">
        <div class="flex justify-between items-center mb-4">
         <h4 class="text-md font-medium">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</h4><span id="importCount" class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">0 ‡∏Ç‡πâ‡∏≠</span>
        </div>
        <div class="overflow-x-auto mb-4">
         <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
           <tr>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</th>
           </tr>
          </thead>
          <tbody id="importPreviewBody" class="bg-white divide-y divide-gray-200"><!-- Preview data will be inserted here -->
          </tbody>
         </table>
        </div>
        <div class="flex gap-4"><button onclick="confirmImport()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200"> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ </button> <button onclick="cancelImport()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button>
        </div>
       </div><!-- Import Instructions -->
       <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h4 class="text-md font-medium text-blue-800 mb-3">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h4>
        <div class="text-sm text-blue-700 space-y-2">
         <p><strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö CSV:</strong> ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ</p>
         <ul class="list-disc list-inside ml-4 space-y-1">
          <li>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Question)</li>
          <li>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A (Option A)</li>
          <li>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B (Option B)</li>
          <li>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C (Option C)</li>
          <li>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D (Option D)</li>
          <li>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å (Correct Answer: A, B, C, ‡∏´‡∏£‡∏∑‡∏≠ D)</li>
          <li>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Category - ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</li>
          <li>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Explanation - ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</li>
         </ul>
         <p><strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Excel:</strong> ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö CSV</p>
         <p><strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö PDF:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)</p>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Configuration
        const defaultConfig = {
            app_title: "‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå",
            exam_duration: "30",
            passing_score: "60",
            primary_color: "#3b82f6",
            success_color: "#10b981",
            danger_color: "#ef4444",
            background_color: "#f8fafc",
            text_color: "#1f2937"
        };

        // Global variables
        let currentUser = null;
        let currentUserRole = null;
        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let examStartTime = null;
        let examTimer = null;
        let timeRemaining = 1800; // 30 minutes in seconds
        let examResults = [];
        let members = [];
        let importedQuestions = [];

        // Sample questions for demo
        const sampleQuestions = [
            {
                questionText: "‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î?",
                options: ["75 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", "76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", "77 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", "78 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"],
                answer: 2,
                category: "‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"
            },
            {
                questionText: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏Ñ‡∏∑‡∏≠?",
                options: ["‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà"],
                answer: 1,
                category: "‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"
            },
            {
                questionText: "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏™‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏Ñ‡∏∑‡∏≠?",
                options: ["‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÇ‡∏Ç‡∏á", "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤", "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏õ‡∏¥‡∏á", "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏ô‡πà‡∏≤‡∏ô"],
                answer: 1,
                category: "‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"
            },
            {
                questionText: "2 + 2 ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?",
                options: ["3", "4", "5", "6"],
                answer: 1,
                category: "‡∏Ñ‡¶£‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"
            },
            {
                questionText: "10 √ó 5 ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?",
                options: ["45", "50", "55", "60"],
                answer: 1,
                category: "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"
            },
            {
                questionText: "‡∏ô‡πâ‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏Å‡∏µ‡πà‡∏≠‡∏á‡∏®‡∏≤‡πÄ‡∏ã‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏™?",
                options: ["90¬∞C", "95¬∞C", "100¬∞C", "105¬∞C"],
                answer: 2,
                category: "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"
            },
            {
                questionText: "‡πÇ‡∏•‡∏Å‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏ó‡∏ß‡∏µ‡∏õ?",
                options: ["5", "6", "7", "8"],
                answer: 2,
                category: "‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"
            },
            {
                questionText: "1 ‡∏õ‡∏µ ‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô? (‡∏õ‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥)",
                options: ["364", "365", "366", "367"],
                answer: 1,
                category: "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"
            },
            {
                questionText: "‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏ò‡∏á‡∏ä‡∏≤‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏™‡∏µ?",
                options: ["2", "3", "4", "5"],
                answer: 1,
                category: "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"
            },
            {
                questionText: "‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏¥‡∏®‡πÉ‡∏î?",
                options: ["‡πÄ‡∏´‡∏ô‡∏∑‡∏≠", "‡πÉ‡∏ï‡πâ", "‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å", "‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å"],
                answer: 2,
                category: "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"
            }
        ];

        // Initialize app
        async function initApp() {
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        // Update app title
                        const titleElements = document.querySelectorAll('#appTitle, #examTitle');
                        titleElements.forEach(el => {
                            el.textContent = config.app_title || defaultConfig.app_title;
                        });
                        
                        // Update exam duration
                        const duration = config.exam_duration || defaultConfig.exam_duration;
                        document.getElementById('examDurationDisplay').textContent = duration;
                        timeRemaining = parseInt(duration) * 60;
                        
                        // Update passing score
                        document.getElementById('passingScoreDisplay').textContent = config.passing_score || defaultConfig.passing_score;
                        
                        // Apply colors
                        document.documentElement.style.setProperty('--primary-color', config.primary_color || defaultConfig.primary_color);
                        document.documentElement.style.setProperty('--success-color', config.success_color || defaultConfig.success_color);
                        document.documentElement.style.setProperty('--danger-color', config.danger_color || defaultConfig.danger_color);
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.primary_color || defaultConfig.primary_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ primary_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.success_color || defaultConfig.success_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ success_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.danger_color || defaultConfig.danger_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ danger_color: value });
                                    }
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["app_title", config.app_title || defaultConfig.app_title],
                        ["exam_duration", config.exam_duration || defaultConfig.exam_duration],
                        ["passing_score", config.passing_score || defaultConfig.passing_score]
                    ])
                });
            }

            // Initialize Firebase auth state listener
            if (window.auth && window.firebaseAuth) {
                window.firebaseAuth.onAuthStateChanged(window.auth, async (user) => {
                    if (user) {
                        currentUser = user;
                        await checkUserRole(user.uid);
                    } else {
                        currentUser = null;
                        currentUserRole = null;
                        showScreen('login');
                    }
                    hideLoadingScreen();
                });
            } else {
                // Demo mode without Firebase
                hideLoadingScreen();
                showScreen('login');
            }

            // Initialize sample questions if Firebase is not available
            if (!window.db) {
                questions = shuffleArray([...sampleQuestions]);
            }
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö role ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        async function checkUserRole(uid) {
            try {
                if (window.db && window.firestore) {
                    const userDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'users', uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        currentUserRole = userData.role;
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                        if (userData.status === 'pending') {
                            document.getElementById('pendingEmail').textContent = currentUser.email;
                            showScreen('pending');
                            return;
                        } else if (userData.status === 'rejected') {
                            showToast('‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô', 'error');
                            logout();
                            return;
                        }
                        
                        if (currentUserRole === 'admin') {
                            await loadAdminData();
                            showScreen('admin');
                        } else if (currentUserRole === 'student' && userData.status === 'approved') {
                            await loadQuestions();
                            showScreen('exam');
                        } else {
                            showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'error');
                            logout();
                        }
                    } else {
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                        await window.firestore.setDoc(window.firestore.doc(window.db, 'users', uid), {
                            name: currentUser.email,
                            email: currentUser.email,
                            role: 'student',
                            status: 'pending',
                            createdAt: new Date().toISOString()
                        });
                        document.getElementById('pendingEmail').textContent = currentUser.email;
                        showScreen('pending');
                    }
                } else {
                    // Demo mode - determine role based on email
                    if (currentUser && currentUser.email === 'admin@test.com') {
                        currentUserRole = 'admin';
                        await loadAdminData();
                        showScreen('admin');
                    } else {
                        currentUserRole = 'student';
                        await loadQuestions();
                        showScreen('exam');
                    }
                }
            } catch (error) {
                console.error('Error checking user role:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå', 'error');
            }
        }

        // Login function
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';
            loginBtn.disabled = true;
            
            try {
                if (window.auth && window.firebaseAuth) {
                    await window.firebaseAuth.signInWithEmailAndPassword(window.auth, email, password);
                } else {
                    // Demo mode
                    if ((email === 'admin@test.com' || email === 'student@test.com') && password === 'password') {
                        currentUser = { email, uid: email.split('@')[0] };
                        await checkUserRole(currentUser.uid);
                    } else {
                        throw new Error('Invalid credentials');
                    }
                }
                showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                console.error('Login error:', error);
                showToast('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            } finally {
                loginBtn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
                loginBtn.disabled = false;
            }
        }

        // Admin login function
        async function loginAsAdmin() {
            const adminBtn = event.target;
            const originalContent = adminBtn.innerHTML;
            
            adminBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';
            adminBtn.disabled = true;
            
            try {
                if (window.auth && window.firebaseAuth && window.db && window.firestore) {
                    // Try to sign in with existing admin credentials
                    const adminEmail = 'admin@test.com';
                    const adminPassword = 'admin123';
                    
                    try {
                        // Try to sign in first
                        const userCredential = await window.firebaseAuth.signInWithEmailAndPassword(window.auth, adminEmail, adminPassword);
                        
                        // Set admin role in Firestore if not exists
                        const userDocRef = window.firestore.doc(window.db, 'users', userCredential.user.uid);
                        const userDoc = await window.firestore.getDoc(userDocRef);
                        
                        if (!userDoc.exists()) {
                            await window.firestore.setDoc(userDocRef, {
                                name: 'Administrator',
                                role: 'admin',
                                email: adminEmail,
                                createdAt: new Date().toISOString()
                            });
                        }
                        
                        showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                        
                    } catch (signInError) {
                        // If sign in fails, try to create admin account
                        if (signInError.code === 'auth/user-not-found' || signInError.code === 'auth/wrong-password' || signInError.code === 'auth/invalid-credential') {
                            try {
                                const { createUserWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js');
                                const userCredential = await createUserWithEmailAndPassword(window.auth, adminEmail, adminPassword);
                                
                                // Set admin role in Firestore
                                await window.firestore.setDoc(window.firestore.doc(window.db, 'users', userCredential.user.uid), {
                                    name: 'Administrator',
                                    role: 'admin',
                                    email: adminEmail,
                                    createdAt: new Date().toISOString()
                                });
                                
                                showToast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                                
                            } catch (createError) {
                                console.error('Error creating admin account:', createError);
                                // Fall back to demo mode
                                currentUser = { email: 'admin@test.com', uid: 'admin' };
                                currentUserRole = 'admin';
                                await loadAdminData();
                                showScreen('admin');
                                showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (Demo Mode)', 'info');
                            }
                        } else {
                            throw signInError;
                        }
                    }
                } else {
                    // Demo mode - direct admin access
                    currentUser = { email: 'admin@test.com', uid: 'admin' };
                    currentUserRole = 'admin';
                    await loadAdminData();
                    showScreen('admin');
                    showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (Demo Mode)', 'info');
                }
            } catch (error) {
                console.error('Admin login error:', error);
                
                // Always fall back to demo mode if there's any error
                try {
                    currentUser = { email: 'admin@test.com', uid: 'admin' };
                    currentUserRole = 'admin';
                    await loadAdminData();
                    showScreen('admin');
                    showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (Demo Mode)', 'info');
                } catch (demoError) {
                    console.error('Demo mode error:', demoError);
                    showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', 'error');
                }
            } finally {
                adminBtn.innerHTML = originalContent;
                adminBtn.disabled = false;
            }
        }

        // Logout function
        async function logout() {
            try {
                if (window.auth && window.firebaseAuth) {
                    await window.firebaseAuth.signOut(window.auth);
                } else {
                    currentUser = null;
                    currentUserRole = null;
                    showScreen('login');
                }
                showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                console.error('Logout error:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö', 'error');
            }
        }

        // Load questions from Firestore
        async function loadQuestions() {
            try {
                if (window.db && window.firestore) {
                    const questionsQuery = window.firestore.query(
                        window.firestore.collection(window.db, 'questionBank'),
                        window.firestore.orderBy('questionText')
                    );
                    const querySnapshot = await window.firestore.getDocs(questionsQuery);
                    
                    questions = [];
                    querySnapshot.forEach((doc) => {
                        questions.push({ id: doc.id, ...doc.data() });
                    });
                    
                    if (questions.length === 0) {
                        // Add sample questions if none exist
                        for (const question of sampleQuestions) {
                            await window.firestore.addDoc(window.firestore.collection(window.db, 'questionBank'), question);
                        }
                        await loadQuestions(); // Reload after adding
                        return;
                    }
                } else {
                    // Use sample questions in demo mode
                    questions = [...sampleQuestions];
                }
                
                // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
                questions = shuffleArray(questions);
                
                // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠
                questions = questions.map(q => {
                    const shuffledOptions = shuffleArrayWithAnswer(q.options, q.answer);
                    return {
                        ...q,
                        options: shuffledOptions.options,
                        answer: shuffledOptions.newAnswerIndex
                    };
                });
                
                document.getElementById('totalQuestions').textContent = questions.length;
                document.getElementById('totalQ').textContent = questions.length;
                
            } catch (error) {
                console.error('Error loading questions:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'error');
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
        function startExam() {
            examStartTime = Date.now();
            
            // Load saved state from localStorage
            const savedState = localStorage.getItem('examState');
            if (savedState) {
                const state = JSON.parse(savedState);
                if (state.examStartTime && (Date.now() - state.examStartTime) < (timeRemaining * 1000)) {
                    examStartTime = state.examStartTime;
                    currentQuestionIndex = state.currentQuestionIndex || 0;
                    userAnswers = state.userAnswers || {};
                    timeRemaining = Math.max(0, timeRemaining - Math.floor((Date.now() - examStartTime) / 1000));
                }
            }
            
            document.getElementById('startExamContainer').style.display = 'none';
            document.getElementById('questionCard').style.display = 'block';
            
            startTimer();
            displayQuestion();
        }

        function startTimer() {
            examTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                // Save state to localStorage
                saveExamState();
                
                if (timeRemaining <= 0) {
                    clearInterval(examTimer);
                    submitExam();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timerElement = document.getElementById('timer');
            
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Add warning class when time is running low
            if (timeRemaining <= 300) { // 5 minutes
                timerElement.classList.add('timer-warning');
            }
        }

        function saveExamState() {
            const state = {
                examStartTime,
                currentQuestionIndex,
                userAnswers,
                timeRemaining
            };
            localStorage.setItem('examState', JSON.stringify(state));
        }

        function displayQuestion() {
            if (questions.length === 0) return;
            
            const question = questions[currentQuestionIndex];
            
            document.getElementById('questionNumber').textContent = `‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${currentQuestionIndex + 1}`;
            document.getElementById('currentQ').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.questionText;
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            // Display choices
            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const choiceDiv = document.createElement('div');
                choiceDiv.className = `choice-option border-2 border-gray-200 rounded-lg p-4 cursor-pointer ${
                    userAnswers[currentQuestionIndex] === index ? 'selected' : ''
                }`;
                
                choiceDiv.innerHTML = `
                    <div class="flex items-center">
                        <input type="radio" name="question${currentQuestionIndex}" value="${index}" 
                               ${userAnswers[currentQuestionIndex] === index ? 'checked' : ''}
                               class="mr-3 h-4 w-4 text-blue-600">
                        <label class="flex-1 cursor-pointer">${String.fromCharCode(65 + index)}. ${option}</label>
                    </div>
                `;
                
                choiceDiv.addEventListener('click', () => selectAnswer(index));
                choicesContainer.appendChild(choiceDiv);
            });
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === questions.length - 1) {
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('submitBtn').style.display = 'inline-block';
            } else {
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('submitBtn').style.display = 'none';
            }
        }

        function selectAnswer(answerIndex) {
            userAnswers[currentQuestionIndex] = answerIndex;
            
            // Update UI
            document.querySelectorAll('.choice-option').forEach((choice, index) => {
                if (index === answerIndex) {
                    choice.classList.add('selected');
                    choice.querySelector('input').checked = true;
                } else {
                    choice.classList.remove('selected');
                    choice.querySelector('input').checked = false;
                }
            });
            
            saveExamState();
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
        async function submitExam() {
            if (examTimer) {
                clearInterval(examTimer);
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ö‡∏ö client-side
            let correctAnswers = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.answer) {
                    correctAnswers++;
                }
            });
            
            const score = Math.round((correctAnswers / questions.length) * 100);
            const timeUsed = Math.floor((Date.now() - examStartTime) / 1000);
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô + ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ + ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏õ Firestore
            const examResult = {
                uid: currentUser.uid,
                name: currentUser.email,
                score: score,
                correctAnswers: correctAnswers,
                totalQuestions: questions.length,
                answers: userAnswers,
                startTime: examStartTime,
                endTime: Date.now(),
                timeUsed: timeUsed,
                device: /Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'Mobile' : 'Desktop',
                submittedAt: new Date().toISOString()
            };
            
            try {
                if (window.db && window.firestore) {
                    await window.firestore.addDoc(window.firestore.collection(window.db, 'examResults'), examResult);
                }
                
                // Clear saved state
                localStorage.removeItem('examState');
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                showResults(examResult);
                
            } catch (error) {
                console.error('Error saving exam result:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•', 'error');
                showResults(examResult); // Still show results even if save failed
            }
        }

        function showResults(result) {
            showScreen('results');
            
            const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
            const passingScore = parseInt(config.passing_score || defaultConfig.passing_score);
            const passed = result.score >= passingScore;
            
            document.getElementById('resultIcon').textContent = passed ? 'üéâ' : 'üòî';
            document.getElementById('scoreDisplay').textContent = `${result.score}%`;
            document.getElementById('scoreDisplay').className = `text-5xl font-bold mb-4 ${passed ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('resultMessage').textContent = passed ? '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô' : '‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô';
            document.getElementById('resultMessage').className = `text-xl mb-6 ${passed ? 'text-green-600' : 'text-red-600'}`;
            
            document.getElementById('finalScore').textContent = `${result.correctAnswers}/${result.totalQuestions}`;
            document.getElementById('timeUsed').textContent = formatTime(result.timeUsed);
            document.getElementById('passStatus').textContent = passed ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô';
            document.getElementById('passStatus').className = `font-medium ml-2 ${passed ? 'text-green-600' : 'text-red-600'}`;
        }

        function resetExam() {
            currentQuestionIndex = 0;
            userAnswers = {};
            const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
            timeRemaining = parseInt(config.exam_duration || defaultConfig.exam_duration) * 60;
            examStartTime = null;
            
            if (examTimer) {
                clearInterval(examTimer);
            }
            
            localStorage.removeItem('examState');
            
            // Reshuffle questions
            questions = shuffleArray(questions);
            questions = questions.map(q => {
                const shuffledOptions = shuffleArrayWithAnswer(q.options, q.answer);
                return {
                    ...q,
                    options: shuffledOptions.options,
                    answer: shuffledOptions.newAnswerIndex
                };
            });
            
            showScreen('exam');
            document.getElementById('startExamContainer').style.display = 'block';
            document.getElementById('questionCard').style.display = 'none';
        }

        // Registration functions
        function showRegisterForm() {
            showScreen('register');
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const phone = document.getElementById('regPhone').value;
            const organization = document.getElementById('regOrganization').value;
            
            if (password !== confirmPassword) {
                showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô', 'error');
                return;
            }
            
            const registerBtn = document.getElementById('registerBtn');
            registerBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';
            registerBtn.disabled = true;
            
            try {
                if (window.auth && window.firebaseAuth && window.db && window.firestore) {
                    const { createUserWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js');
                    const userCredential = await createUserWithEmailAndPassword(window.auth, email, password);
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                    await window.firestore.setDoc(window.firestore.doc(window.db, 'users', userCredential.user.uid), {
                        name: name,
                        email: email,
                        phone: phone || '',
                        organization: organization || '',
                        role: 'student',
                        status: 'pending',
                        createdAt: new Date().toISOString()
                    });
                    
                    showToast('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô', 'success');
                    document.getElementById('pendingEmail').textContent = email;
                    showScreen('pending');
                } else {
                    // Demo mode
                    showToast('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Demo Mode)', 'success');
                    currentUser = { email, uid: email.split('@')[0] };
                    currentUserRole = 'student';
                    await loadQuestions();
                    showScreen('exam');
                }
            } catch (error) {
                console.error('Registration error:', error);
                if (error.code === 'auth/email-already-in-use') {
                    showToast('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'error');
                } else if (error.code === 'auth/weak-password') {
                    showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'error');
                } else {
                    showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', 'error');
                }
            } finally {
                registerBtn.innerHTML = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
                registerBtn.disabled = false;
            }
        }

        async function checkApprovalStatus() {
            if (!currentUser) return;
            
            try {
                if (window.db && window.firestore) {
                    const userDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'users', currentUser.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        if (userData.status === 'approved') {
                            showToast('‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                            await checkUserRole(currentUser.uid);
                        } else if (userData.status === 'rejected') {
                            showToast('‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', 'error');
                        } else {
                            showToast('‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'info');
                        }
                    }
                }
            } catch (error) {
                console.error('Error checking approval status:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', 'error');
            }
        }

        // Member management functions
        async function loadMembers() {
            try {
                if (window.db && window.firestore) {
                    const usersQuery = window.firestore.query(
                        window.firestore.collection(window.db, 'users'),
                        window.firestore.orderBy('createdAt', 'desc')
                    );
                    const querySnapshot = await window.firestore.getDocs(usersQuery);
                    
                    members = [];
                    querySnapshot.forEach((doc) => {
                        const userData = doc.data();
                        if (userData.role !== 'admin') { // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
                            members.push({ id: doc.id, ...userData });
                        }
                    });
                } else {
                    // Demo data
                    members = [
                        {
                            id: '1',
                            name: '‡∏ô‡∏≤‡∏¢ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö',
                            email: 'test@example.com',
                            organization: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏à‡∏≥‡∏Å‡∏±‡∏î',
                            role: 'student',
                            status: 'pending',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: '2',
                            name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                            email: 'example@test.com',
                            organization: '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏±‡∏ê',
                            role: 'student',
                            status: 'approved',
                            createdAt: new Date(Date.now() - 86400000).toISOString()
                        }
                    ];
                }
                
                updateMembersTable();
                updatePendingAlert();
                
            } catch (error) {
                console.error('Error loading members:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', 'error');
            }
        }

        function updateMembersTable() {
            const tbody = document.getElementById('membersTableBody');
            tbody.innerHTML = '';
            
            const filter = document.getElementById('memberStatusFilter').value;
            const filteredMembers = filter === 'all' ? members : members.filter(m => m.status === filter);
            
            filteredMembers.forEach(member => {
                const row = document.createElement('tr');
                
                let statusBadge = '';
                switch (member.status) {
                    case 'pending':
                        statusBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
                        break;
                    case 'approved':
                        statusBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>';
                        break;
                    case 'rejected':
                        statusBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</span>';
                        break;
                }
                
                let roleBadge = '';
                switch (member.role) {
                    case 'student':
                        roleBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>';
                        break;
                    case 'admin':
                        roleBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>';
                        break;
                }
                
                let actions = '';
                if (member.status === 'pending') {
                    actions = `
                        <div class="flex gap-2">
                            <button onclick="approveMember('${member.id}')" 
                                    class="text-green-600 hover:text-green-800 text-sm font-medium">
                                ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                            </button>
                            <button onclick="rejectMember('${member.id}')" 
                                    class="text-red-600 hover:text-red-800 text-sm font-medium">
                                ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                            </button>
                        </div>
                    `;
                } else if (member.status === 'approved') {
                    actions = `
                        <div class="flex gap-2">
                            <select onchange="changeUserRole('${member.id}', this.value)" 
                                    class="text-sm border border-gray-300 rounded px-2 py-1">
                                <option value="student" ${member.role === 'student' ? 'selected' : ''}>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                                <option value="admin" ${member.role === 'admin' ? 'selected' : ''}>‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</option>
                            </select>
                            <button onclick="suspendMember('${member.id}')" 
                                    class="text-orange-600 hover:text-orange-800 text-sm font-medium">
                                ‡∏£‡∏∞‡∏á‡∏±‡∏ö
                            </button>
                        </div>
                    `;
                } else {
                    actions = `
                        <button onclick="approveMember('${member.id}')" 
                                class="text-green-600 hover:text-green-800 text-sm font-medium">
                            ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${member.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${member.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${member.organization || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${roleBadge}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(member.createdAt).toLocaleDateString('th-TH')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${actions}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updatePendingAlert() {
            const pendingMembers = members.filter(m => m.status === 'pending');
            const alertDiv = document.getElementById('pendingAlert');
            const countSpan = document.getElementById('pendingCount');
            
            if (pendingMembers.length > 0) {
                countSpan.textContent = pendingMembers.length;
                alertDiv.classList.remove('hidden');
            } else {
                alertDiv.classList.add('hidden');
            }
        }

        function filterMembers() {
            updateMembersTable();
        }

        async function approveMember(memberId) {
            try {
                if (window.db && window.firestore) {
                    await window.firestore.setDoc(window.firestore.doc(window.db, 'users', memberId), {
                        status: 'approved'
                    }, { merge: true });
                }
                
                // Update local data
                const member = members.find(m => m.id === memberId);
                if (member) {
                    member.status = 'approved';
                }
                
                updateMembersTable();
                updatePendingAlert();
                showToast('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                
            } catch (error) {
                console.error('Error approving member:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', 'error');
            }
        }

        async function rejectMember(memberId) {
            try {
                if (window.db && window.firestore) {
                    await window.firestore.setDoc(window.firestore.doc(window.db, 'users', memberId), {
                        status: 'rejected'
                    }, { merge: true });
                }
                
                // Update local data
                const member = members.find(m => m.id === memberId);
                if (member) {
                    member.status = 'rejected';
                }
                
                updateMembersTable();
                updatePendingAlert();
                showToast('‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                
            } catch (error) {
                console.error('Error rejecting member:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', 'error');
            }
        }

        async function changeUserRole(memberId, newRole) {
            try {
                if (window.db && window.firestore) {
                    await window.firestore.setDoc(window.firestore.doc(window.db, 'users', memberId), {
                        role: newRole
                    }, { merge: true });
                }
                
                // Update local data
                const member = members.find(m => m.id === memberId);
                if (member) {
                    member.role = newRole;
                }
                
                updateMembersTable();
                showToast(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏õ‡πá‡∏ô${newRole === 'admin' ? '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô' : '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'}‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
                
            } catch (error) {
                console.error('Error changing user role:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå', 'error');
            }
        }

        async function suspendMember(memberId) {
            try {
                if (window.db && window.firestore) {
                    await window.firestore.setDoc(window.firestore.doc(window.db, 'users', memberId), {
                        status: 'rejected'
                    }, { merge: true });
                }
                
                // Update local data
                const member = members.find(m => m.id === memberId);
                if (member) {
                    member.status = 'rejected';
                }
                
                updateMembersTable();
                showToast('‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                
            } catch (error) {
                console.error('Error suspending member:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', 'error');
            }
        }

        // File import functions
        function downloadTemplate() {
            const csvContent = '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°,‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A,‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B,‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C,‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D,‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å,‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà,‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢\n' +
                              '‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î?,75 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î,76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î,77 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î,78 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î,C,‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå,‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏°‡∏µ 77 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î\n' +
                              '2 + 2 ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?,3,4,5,6,B,‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå,‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô';
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'exam_template.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        async function processImportFile() {
            const fileInput = document.getElementById('examFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå', 'error');
                return;
            }
            
            try {
                let questions = [];
                
                if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
                    questions = await parseCSV(file);
                } else if (file.type.includes('sheet') || file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    questions = await parseExcel(file);
                } else if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
                    questions = await parsePDF(file);
                } else {
                    showToast('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö', 'error');
                    return;
                }
                
                if (questions.length === 0) {
                    showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå', 'error');
                    return;
                }
                
                importedQuestions = questions;
                showImportPreview(questions);
                
            } catch (error) {
                console.error('Error processing import file:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå', 'error');
            }
        }

        async function parseCSV(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        const questions = [];
                        
                        // Skip header row
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;
                            
                            const columns = parseCSVLine(line);
                            if (columns.length >= 6) {
                                const answerMap = { 'A': 0, 'B': 1, 'C': 2, 'D': 3 };
                                const correctAnswer = answerMap[columns[5].toUpperCase()] ?? 0;
                                
                                questions.push({
                                    questionText: columns[0],
                                    options: [columns[1], columns[2], columns[3], columns[4]],
                                    answer: correctAnswer,
                                    category: columns[6] || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
                                    explanation: columns[7] || ''
                                });
                            }
                        }
                        resolve(questions);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.readAsText(file, 'UTF-8');
            });
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        async function parseExcel(file) {
            // Simplified Excel parsing - in real implementation, you'd use a library like SheetJS
            showToast('‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Excel ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå CSV', 'error');
            return [];
        }

        async function parsePDF(file) {
            // Simplified PDF parsing - in real implementation, you'd use PDF.js
            showToast('‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ PDF ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå CSV', 'error');
            return [];
        }

        function showImportPreview(questions) {
            const previewDiv = document.getElementById('importPreview');
            const countSpan = document.getElementById('importCount');
            const tbody = document.getElementById('importPreviewBody');
            
            countSpan.textContent = `${questions.length} ‡∏Ç‡πâ‡∏≠`;
            tbody.innerHTML = '';
            
            // Show first 5 questions as preview
            const previewQuestions = questions.slice(0, 5);
            previewQuestions.forEach((question, index) => {
                const row = document.createElement('tr');
                const answerLetter = String.fromCharCode(65 + question.answer);
                
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm text-gray-900">${question.questionText.substring(0, 50)}${question.questionText.length > 50 ? '...' : ''}</td>
                    <td class="px-4 py-2 text-sm text-gray-900">${question.options[0]}</td>
                    <td class="px-4 py-2 text-sm text-gray-900">${question.options[1]}</td>
                    <td class="px-4 py-2 text-sm text-gray-900">${question.options[2]}</td>
                    <td class="px-4 py-2 text-sm text-gray-900">${question.options[3]}</td>
                    <td class="px-4 py-2 text-sm font-medium text-green-600">${answerLetter}</td>
                `;
                tbody.appendChild(row);
            });
            
            if (questions.length > 5) {
                const moreRow = document.createElement('tr');
                moreRow.innerHTML = `
                    <td colspan="6" class="px-4 py-2 text-sm text-gray-500 text-center">
                        ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å ${questions.length - 5} ‡∏Ç‡πâ‡∏≠...
                    </td>
                `;
                tbody.appendChild(moreRow);
            }
            
            previewDiv.classList.remove('hidden');
        }

        async function confirmImport() {
            try {
                if (window.db && window.firestore) {
                    for (const question of importedQuestions) {
                        await window.firestore.addDoc(window.firestore.collection(window.db, 'questionBank'), question);
                    }
                }
                
                showToast(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ${importedQuestions.length} ‡∏Ç‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
                cancelImport();
                await loadQuestionsForAdmin();
                
            } catch (error) {
                console.error('Error importing questions:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'error');
            }
        }

        function cancelImport() {
            document.getElementById('importPreview').classList.add('hidden');
            document.getElementById('examFileInput').value = '';
            importedQuestions = [];
        }

        // Admin functions
        async function loadAdminData() {
            try {
                if (window.db && window.firestore) {
                    // ‡πÇ‡∏´‡∏•‡∏î Dashboard
                    const resultsQuery = window.firestore.query(
                        window.firestore.collection(window.db, 'examResults'),
                        window.firestore.orderBy('submittedAt', 'desc')
                    );
                    const querySnapshot = await window.firestore.getDocs(resultsQuery);
                    
                    examResults = [];
                    querySnapshot.forEach((doc) => {
                        examResults.push({ id: doc.id, ...doc.data() });
                    });
                } else {
                    // Demo data
                    examResults = [
                        {
                            name: 'student@test.com',
                            score: 85,
                            timeUsed: 1200,
                            submittedAt: new Date().toISOString()
                        },
                        {
                            name: 'demo@test.com',
                            score: 45,
                            timeUsed: 1800,
                            submittedAt: new Date(Date.now() - 86400000).toISOString()
                        }
                    ];
                }
                
                updateAdminStats();
                updateResultsTable();
                await loadQuestionsForAdmin();
                await loadMembers();
                
            } catch (error) {
                console.error('Error loading admin data:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        function updateAdminStats() {
            const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
            const passingScore = parseInt(config.passing_score || defaultConfig.passing_score);
            
            const totalStudents = examResults.length;
            const passedStudents = examResults.filter(result => result.score >= passingScore).length;
            const failedStudents = totalStudents - passedStudents;
            
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('passedStudents').textContent = passedStudents;
            document.getElementById('failedStudents').textContent = failedStudents;
        }

        function updateResultsTable() {
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';
            
            const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
            const passingScore = parseInt(config.passing_score || defaultConfig.passing_score);
            
            examResults.forEach(result => {
                const row = document.createElement('tr');
                const passed = result.score >= passingScore;
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${result.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${result.score}%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatTime(result.timeUsed)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(result.submittedAt).toLocaleDateString('th-TH')}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            passed ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }">
                            ${passed ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function loadQuestionsForAdmin() {
            try {
                let adminQuestions = [];
                
                if (window.db && window.firestore) {
                    const questionsQuery = window.firestore.query(
                        window.firestore.collection(window.db, 'questionBank'),
                        window.firestore.orderBy('questionText')
                    );
                    const querySnapshot = await window.firestore.getDocs(questionsQuery);
                    
                    querySnapshot.forEach((doc) => {
                        adminQuestions.push({ id: doc.id, ...doc.data() });
                    });
                } else {
                    adminQuestions = [...sampleQuestions];
                }
                
                displayQuestionsForAdmin(adminQuestions);
                
            } catch (error) {
                console.error('Error loading questions for admin:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'error');
            }
        }

        function displayQuestionsForAdmin(adminQuestions) {
            const questionsList = document.getElementById('questionsList');
            questionsList.innerHTML = '';
            
            adminQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'bg-gray-50 rounded-lg p-4 border border-gray-200';
                
                questionDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-medium text-gray-900">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${index + 1}</h4>
                        <div class="flex gap-2">
                            <button onclick="editQuestion('${question.id || index}')" 
                                    class="text-blue-600 hover:text-blue-800 text-sm">
                                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button onclick="deleteQuestion('${question.id || index}')" 
                                    class="text-red-600 hover:text-red-800 text-sm">
                                ‡∏•‡∏ö
                            </button>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-3">${question.questionText}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-3">
                        ${question.options.map((option, i) => `
                            <div class="flex items-center">
                                <span class="w-6 h-6 rounded-full ${i === question.answer ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'} 
                                      flex items-center justify-center text-xs font-medium mr-2">
                                    ${String.fromCharCode(65 + i)}
                                </span>
                                <span class="text-sm ${i === question.answer ? 'font-medium text-green-800' : 'text-gray-600'}">${option}</span>
                            </div>
                        `).join('')}
                    </div>
                    ${question.explanation ? `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-2">
                            <div class="flex items-start">
                                <span class="text-yellow-600 mr-2">üí°</span>
                                <div>
                                    <p class="text-sm font-medium text-yellow-800 mb-1">‡πÄ‡∏â‡∏•‡∏¢:</p>
                                    <p class="text-sm text-yellow-700">${question.explanation}</p>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    ${question.category ? `<span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${question.category}</span>` : ''}
                `;
                
                questionsList.appendChild(questionDiv);
            });
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡∏•‡∏ö / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏ô Firestore
        let editingQuestionId = null;
        
        async function addQuestion(event) {
            event.preventDefault();
            
            const questionData = {
                questionText: document.getElementById('questionTextInput').value,
                options: [
                    document.getElementById('optionA').value,
                    document.getElementById('optionB').value,
                    document.getElementById('optionC').value,
                    document.getElementById('optionD').value
                ],
                answer: parseInt(document.getElementById('correctAnswer').value),
                category: document.getElementById('category').value || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
                explanation: document.getElementById('explanation').value || ''
            };
            
            try {
                if (editingQuestionId) {
                    // Update existing question
                    if (window.db && window.firestore) {
                        await window.firestore.setDoc(window.firestore.doc(window.db, 'questionBank', editingQuestionId), questionData);
                    }
                    showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    editingQuestionId = null;
                } else {
                    // Add new question
                    if (window.db && window.firestore) {
                        await window.firestore.addDoc(window.firestore.collection(window.db, 'questionBank'), questionData);
                    }
                    showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                }
                
                document.getElementById('questionForm').reset();
                hideAddQuestionForm();
                await loadQuestionsForAdmin();
                
            } catch (error) {
                console.error('Error saving question:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'error');
            }
        }
        
        async function editQuestion(questionId) {
            try {
                let question = null;
                
                if (window.db && window.firestore && questionId !== parseInt(questionId)) {
                    const questionDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'questionBank', questionId));
                    if (questionDoc.exists()) {
                        question = questionDoc.data();
                    }
                } else {
                    // Demo mode - find question by index
                    const adminQuestions = [...sampleQuestions];
                    question = adminQuestions[parseInt(questionId)];
                }
                
                if (question) {
                    editingQuestionId = questionId;
                    
                    // Fill form with existing data
                    document.getElementById('questionTextInput').value = question.questionText;
                    document.getElementById('optionA').value = question.options[0];
                    document.getElementById('optionB').value = question.options[1];
                    document.getElementById('optionC').value = question.options[2];
                    document.getElementById('optionD').value = question.options[3];
                    document.getElementById('correctAnswer').value = question.answer;
                    document.getElementById('category').value = question.category || '';
                    document.getElementById('explanation').value = question.explanation || '';
                    
                    // Update form title
                    document.querySelector('#addQuestionForm h4').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö';
                    document.querySelector('#questionForm button[type="submit"]').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
                    
                    showAddQuestionForm();
                }
                
            } catch (error) {
                console.error('Error loading question for edit:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'error');
            }
        }

        async function deleteQuestion(questionId) {
            // Create custom confirmation dialog
            const confirmDialog = document.createElement('div');
            confirmDialog.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmDialog.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
                    <p class="text-gray-600 mb-6">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ?</p>
                    <div class="flex gap-3 justify-end">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button onclick="confirmDeleteQuestion('${questionId}'); this.closest('.fixed').remove()" 
                                class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700">
                            ‡∏•‡∏ö
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDialog);
        }
        
        async function confirmDeleteQuestion(questionId) {
            try {
                if (window.db && window.firestore && questionId !== parseInt(questionId)) {
                    await window.firestore.deleteDoc(window.firestore.doc(window.db, 'questionBank', questionId));
                }
                
                showToast('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                await loadQuestionsForAdmin();
                
            } catch (error) {
                console.error('Error deleting question:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö', 'error');
            }
        }
        
        // Answer review functions
        function showAnswerReview() {
            document.getElementById('answerReviewSection').classList.remove('hidden');
            displayAnswerReview();
        }
        
        function hideAnswerReview() {
            document.getElementById('answerReviewSection').classList.add('hidden');
        }
        
        function displayAnswerReview() {
            const reviewContainer = document.getElementById('reviewQuestions');
            reviewContainer.innerHTML = '';
            
            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.answer;
                
                const reviewDiv = document.createElement('div');
                reviewDiv.className = `border rounded-lg p-4 ${isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}`;
                
                reviewDiv.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <h3 class="font-medium text-gray-900">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${index + 1}</h3>
                        <span class="px-2 py-1 rounded text-sm font-medium ${
                            isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }">
                            ${isCorrect ? '‚úì ‡∏ñ‡∏π‡∏Å' : '‚úó ‡∏ú‡∏¥‡∏î'}
                        </span>
                    </div>
                    
                    <p class="text-gray-700 mb-4">${question.questionText}</p>
                    
                    <div class="space-y-2 mb-4">
                        ${question.options.map((option, i) => {
                            let className = 'flex items-center p-2 rounded border ';
                            let icon = '';
                            
                            if (i === question.answer) {
                                className += 'border-green-300 bg-green-100';
                                icon = '‚úì';
                            } else if (i === userAnswer && userAnswer !== question.answer) {
                                className += 'border-red-300 bg-red-100';
                                icon = '‚úó';
                            } else {
                                className += 'border-gray-200 bg-gray-50';
                            }
                            
                            return `
                                <div class="${className}">
                                    <span class="w-6 h-6 rounded-full bg-white flex items-center justify-center text-xs font-medium mr-3">
                                        ${String.fromCharCode(65 + i)}
                                    </span>
                                    <span class="flex-1">${option}</span>
                                    ${icon ? `<span class="ml-2 font-bold">${icon}</span>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="border-t pt-3">
                        <div class="flex items-start">
                            <span class="text-blue-600 mr-2 mt-1">üí°</span>
                            <div>
                                <p class="font-medium text-blue-800 mb-1">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å: ${String.fromCharCode(65 + question.answer)}</p>
                                ${question.explanation ? `<p class="text-blue-700 text-sm">${question.explanation}</p>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                reviewContainer.appendChild(reviewDiv);
            });
        }

        // Export CSV/XLSX
        function exportResults() {
            const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
            const passingScore = parseInt(config.passing_score || defaultConfig.passing_score);
            
            let csv = '‡∏ä‡∏∑‡πà‡∏≠,‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô,‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞\n';
            
            examResults.forEach(result => {
                const passed = result.score >= passingScore;
                csv += `${result.name},${result.score}%,${formatTime(result.timeUsed)},${new Date(result.submittedAt).toLocaleDateString('th-TH')},${passed ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `exam_results_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // UI Helper functions
        function showScreen(screenName) {
            const screens = ['login', 'register', 'pending', 'exam', 'results', 'admin'];
            screens.forEach(screen => {
                const screenElement = document.getElementById(`${screen}Screen`);
                if (screenElement) {
                    screenElement.classList.add('hidden');
                }
            });
            document.getElementById(`${screenName}Screen`).classList.remove('hidden');
        }

        function hideLoadingScreen() {
            document.getElementById('loadingScreen').style.display = 'none';
        }

        function showTab(tabName) {
            // Update tab buttons
            const tabs = ['results', 'questions', 'members', 'import'];
            tabs.forEach(tab => {
                const tabElement = document.getElementById(`${tab}Tab`);
                if (tabElement) {
                    tabElement.className = 'py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700';
                }
            });
            
            document.getElementById(`${tabName}Tab`).className = 'py-4 px-1 border-b-2 border-blue-500 font-medium text-blue-600';
            
            // Update tab content
            tabs.forEach(tab => {
                const contentElement = document.getElementById(`${tab}TabContent`);
                if (contentElement) {
                    contentElement.classList.add('hidden');
                }
            });
            
            document.getElementById(`${tabName}TabContent`).classList.remove('hidden');
        }

        function showAddQuestionForm() {
            document.getElementById('addQuestionForm').classList.remove('hidden');
        }

        function hideAddQuestionForm() {
            document.getElementById('addQuestionForm').classList.add('hidden');
            // Reset form state
            editingQuestionId = null;
            document.querySelector('#addQuestionForm h4').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà';
            document.querySelector('#questionForm button[type="submit"]').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö';
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Utility functions
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function shuffleArrayWithAnswer(options, correctAnswerIndex) {
            const optionsWithIndex = options.map((option, index) => ({ option, index }));
            const shuffled = shuffleArray(optionsWithIndex);
            
            return {
                options: shuffled.map(item => item.option),
                newAnswerIndex: shuffled.findIndex(item => item.index === correctAnswerIndex)
            };
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ ${remainingSeconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Register form
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            
            // Question form
            document.getElementById('questionForm').addEventListener('submit', addQuestion);
            
            // Prevent page refresh during exam
            window.addEventListener('beforeunload', (e) => {
                if (examTimer && timeRemaining > 0) {
                    e.preventDefault();
                    e.returnValue = '';
                }
            });
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99f45ca9901945c4',t:'MTc2MzI2ODU2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
